try{self["workbox:core:7.0.0"]&&_()}catch{}const vr=(t,...e)=>{let n=t;return e.length>0&&(n+=` :: ${JSON.stringify(e)}`),n},_r=vr;class z extends Error{constructor(e,n){const r=_r(e,n);super(r),this.name=e,this.details=n}}const ne={googleAnalytics:"googleAnalytics",precache:"precache-v2",prefix:"workbox",runtime:"runtime",suffix:typeof registration<"u"?registration.scope:""},Tt=t=>[ne.prefix,t,ne.suffix].filter(e=>e&&e.length>0).join("-"),kr=t=>{for(const e of Object.keys(ne))t(e)},It={updateDetails:t=>{kr(e=>{typeof t[e]=="string"&&(ne[e]=t[e])})},getGoogleAnalyticsName:t=>t||Tt(ne.googleAnalytics),getPrecacheName:t=>t||Tt(ne.precache),getPrefix:()=>ne.prefix,getRuntimeName:t=>t||Tt(ne.runtime),getSuffix:()=>ne.suffix};function En(t,e){const n=e();return t.waitUntil(n),n}try{self["workbox:precaching:7.0.0"]&&_()}catch{}const xr="__WB_REVISION__";function Pr(t){if(!t)throw new z("add-to-cache-list-unexpected-type",{entry:t});if(typeof t=="string"){const a=new URL(t,location.href);return{cacheKey:a.href,url:a.href}}const{revision:e,url:n}=t;if(!n)throw new z("add-to-cache-list-unexpected-type",{entry:t});if(!e){const a=new URL(n,location.href);return{cacheKey:a.href,url:a.href}}const r=new URL(n,location.href),s=new URL(n,location.href);return r.searchParams.set(xr,e),{cacheKey:r.href,url:s.href}}class Rr{constructor(){this.updatedURLs=[],this.notUpdatedURLs=[],this.handlerWillStart=async({request:e,state:n})=>{n&&(n.originalRequest=e)},this.cachedResponseWillBeUsed=async({event:e,state:n,cachedResponse:r})=>{if(e.type==="install"&&n&&n.originalRequest&&n.originalRequest instanceof Request){const s=n.originalRequest.url;r?this.notUpdatedURLs.push(s):this.updatedURLs.push(s)}return r}}}class Cr{constructor({precacheController:e}){this.cacheKeyWillBeUsed=async({request:n,params:r})=>{const s=(r==null?void 0:r.cacheKey)||this._precacheController.getCacheKeyForURL(n.url);return s?new Request(s,{headers:n.headers}):n},this._precacheController=e}}let Le;function Er(){if(Le===void 0){const t=new Response("");if("body"in t)try{new Response(t.body),Le=!0}catch{Le=!1}Le=!1}return Le}async function jr(t,e){let n=null;if(t.url&&(n=new URL(t.url).origin),n!==self.location.origin)throw new z("cross-origin-copy-response",{origin:n});const r=t.clone(),s={headers:new Headers(r.headers),status:r.status,statusText:r.statusText},a=e?e(s):s,i=Er()?r.body:await r.blob();return new Response(i,a)}const Ir=t=>new URL(String(t),location.href).href.replace(new RegExp(`^${location.origin}`),"");function jn(t,e){const n=new URL(t);for(const r of e)n.searchParams.delete(r);return n.href}async function Sr(t,e,n,r){const s=jn(e.url,n);if(e.url===s)return t.match(e,r);const a=Object.assign(Object.assign({},r),{ignoreSearch:!0}),i=await t.keys(e,a);for(const o of i){const c=jn(o.url,n);if(s===c)return t.match(o,r)}}class Kr{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}const Or=new Set;async function Tr(){for(const t of Or)await t()}function Ar(t){return new Promise(e=>setTimeout(e,t))}try{self["workbox:strategies:7.0.0"]&&_()}catch{}function st(t){return typeof t=="string"?new Request(t):t}class Dr{constructor(e,n){this._cacheKeys={},Object.assign(this,n),this.event=n.event,this._strategy=e,this._handlerDeferred=new Kr,this._extendLifetimePromises=[],this._plugins=[...e.plugins],this._pluginStateMap=new Map;for(const r of this._plugins)this._pluginStateMap.set(r,{});this.event.waitUntil(this._handlerDeferred.promise)}async fetch(e){const{event:n}=this;let r=st(e);if(r.mode==="navigate"&&n instanceof FetchEvent&&n.preloadResponse){const i=await n.preloadResponse;if(i)return i}const s=this.hasCallback("fetchDidFail")?r.clone():null;try{for(const i of this.iterateCallbacks("requestWillFetch"))r=await i({request:r.clone(),event:n})}catch(i){if(i instanceof Error)throw new z("plugin-error-request-will-fetch",{thrownErrorMessage:i.message})}const a=r.clone();try{let i;i=await fetch(r,r.mode==="navigate"?void 0:this._strategy.fetchOptions);for(const o of this.iterateCallbacks("fetchDidSucceed"))i=await o({event:n,request:a,response:i});return i}catch(i){throw s&&await this.runCallbacks("fetchDidFail",{error:i,event:n,originalRequest:s.clone(),request:a.clone()}),i}}async fetchAndCachePut(e){const n=await this.fetch(e),r=n.clone();return this.waitUntil(this.cachePut(e,r)),n}async cacheMatch(e){const n=st(e);let r;const{cacheName:s,matchOptions:a}=this._strategy,i=await this.getCacheKey(n,"read"),o=Object.assign(Object.assign({},a),{cacheName:s});r=await caches.match(i,o);for(const c of this.iterateCallbacks("cachedResponseWillBeUsed"))r=await c({cacheName:s,matchOptions:a,cachedResponse:r,request:i,event:this.event})||void 0;return r}async cachePut(e,n){const r=st(e);await Ar(0);const s=await this.getCacheKey(r,"write");if(!n)throw new z("cache-put-with-no-response",{url:Ir(s.url)});const a=await this._ensureResponseSafeToCache(n);if(!a)return!1;const{cacheName:i,matchOptions:o}=this._strategy,c=await self.caches.open(i),l=this.hasCallback("cacheDidUpdate"),u=l?await Sr(c,s.clone(),["__WB_REVISION__"],o):null;try{await c.put(s,l?a.clone():a)}catch(d){if(d instanceof Error)throw d.name==="QuotaExceededError"&&await Tr(),d}for(const d of this.iterateCallbacks("cacheDidUpdate"))await d({cacheName:i,oldResponse:u,newResponse:a.clone(),request:s,event:this.event});return!0}async getCacheKey(e,n){const r=`${e.url} | ${n}`;if(!this._cacheKeys[r]){let s=e;for(const a of this.iterateCallbacks("cacheKeyWillBeUsed"))s=st(await a({mode:n,request:s,event:this.event,params:this.params}));this._cacheKeys[r]=s}return this._cacheKeys[r]}hasCallback(e){for(const n of this._strategy.plugins)if(e in n)return!0;return!1}async runCallbacks(e,n){for(const r of this.iterateCallbacks(e))await r(n)}*iterateCallbacks(e){for(const n of this._strategy.plugins)if(typeof n[e]=="function"){const r=this._pluginStateMap.get(n);yield a=>{const i=Object.assign(Object.assign({},a),{state:r});return n[e](i)}}}waitUntil(e){return this._extendLifetimePromises.push(e),e}async doneWaiting(){let e;for(;e=this._extendLifetimePromises.shift();)await e}destroy(){this._handlerDeferred.resolve(null)}async _ensureResponseSafeToCache(e){let n=e,r=!1;for(const s of this.iterateCallbacks("cacheWillUpdate"))if(n=await s({request:this.request,response:n,event:this.event})||void 0,r=!0,!n)break;return r||n&&n.status!==200&&(n=void 0),n}}class Nr{constructor(e={}){this.cacheName=It.getRuntimeName(e.cacheName),this.plugins=e.plugins||[],this.fetchOptions=e.fetchOptions,this.matchOptions=e.matchOptions}handle(e){const[n]=this.handleAll(e);return n}handleAll(e){e instanceof FetchEvent&&(e={event:e,request:e.request});const n=e.event,r=typeof e.request=="string"?new Request(e.request):e.request,s="params"in e?e.params:void 0,a=new Dr(this,{event:n,request:r,params:s}),i=this._getResponse(a,r,n),o=this._awaitComplete(i,a,r,n);return[i,o]}async _getResponse(e,n,r){await e.runCallbacks("handlerWillStart",{event:r,request:n});let s;try{if(s=await this._handle(n,e),!s||s.type==="error")throw new z("no-response",{url:n.url})}catch(a){if(a instanceof Error){for(const i of e.iterateCallbacks("handlerDidError"))if(s=await i({error:a,event:r,request:n}),s)break}if(!s)throw a}for(const a of e.iterateCallbacks("handlerWillRespond"))s=await a({event:r,request:n,response:s});return s}async _awaitComplete(e,n,r,s){let a,i;try{a=await e}catch{}try{await n.runCallbacks("handlerDidRespond",{event:s,request:r,response:a}),await n.doneWaiting()}catch(o){o instanceof Error&&(i=o)}if(await n.runCallbacks("handlerDidComplete",{event:s,request:r,response:a,error:i}),n.destroy(),i)throw i}}class de extends Nr{constructor(e={}){e.cacheName=It.getPrecacheName(e.cacheName),super(e),this._fallbackToNetwork=e.fallbackToNetwork!==!1,this.plugins.push(de.copyRedirectedCacheableResponsesPlugin)}async _handle(e,n){const r=await n.cacheMatch(e);return r||(n.event&&n.event.type==="install"?await this._handleInstall(e,n):await this._handleFetch(e,n))}async _handleFetch(e,n){let r;const s=n.params||{};if(this._fallbackToNetwork){const a=s.integrity,i=e.integrity,o=!i||i===a;r=await n.fetch(new Request(e,{integrity:e.mode!=="no-cors"?i||a:void 0})),a&&o&&e.mode!=="no-cors"&&(this._useDefaultCacheabilityPluginIfNeeded(),await n.cachePut(e,r.clone()))}else throw new z("missing-precache-entry",{cacheName:this.cacheName,url:e.url});return r}async _handleInstall(e,n){this._useDefaultCacheabilityPluginIfNeeded();const r=await n.fetch(e);if(!await n.cachePut(e,r.clone()))throw new z("bad-precaching-response",{url:e.url,status:r.status});return r}_useDefaultCacheabilityPluginIfNeeded(){let e=null,n=0;for(const[r,s]of this.plugins.entries())s!==de.copyRedirectedCacheableResponsesPlugin&&(s===de.defaultPrecacheCacheabilityPlugin&&(e=r),s.cacheWillUpdate&&n++);n===0?this.plugins.push(de.defaultPrecacheCacheabilityPlugin):n>1&&e!==null&&this.plugins.splice(e,1)}}de.defaultPrecacheCacheabilityPlugin={async cacheWillUpdate({response:t}){return!t||t.status>=400?null:t}};de.copyRedirectedCacheableResponsesPlugin={async cacheWillUpdate({response:t}){return t.redirected?await jr(t):t}};class Br{constructor({cacheName:e,plugins:n=[],fallbackToNetwork:r=!0}={}){this._urlsToCacheKeys=new Map,this._urlsToCacheModes=new Map,this._cacheKeysToIntegrities=new Map,this._strategy=new de({cacheName:It.getPrecacheName(e),plugins:[...n,new Cr({precacheController:this})],fallbackToNetwork:r}),this.install=this.install.bind(this),this.activate=this.activate.bind(this)}get strategy(){return this._strategy}precache(e){this.addToCacheList(e),this._installAndActiveListenersAdded||(self.addEventListener("install",this.install),self.addEventListener("activate",this.activate),this._installAndActiveListenersAdded=!0)}addToCacheList(e){const n=[];for(const r of e){typeof r=="string"?n.push(r):r&&r.revision===void 0&&n.push(r.url);const{cacheKey:s,url:a}=Pr(r),i=typeof r!="string"&&r.revision?"reload":"default";if(this._urlsToCacheKeys.has(a)&&this._urlsToCacheKeys.get(a)!==s)throw new z("add-to-cache-list-conflicting-entries",{firstEntry:this._urlsToCacheKeys.get(a),secondEntry:s});if(typeof r!="string"&&r.integrity){if(this._cacheKeysToIntegrities.has(s)&&this._cacheKeysToIntegrities.get(s)!==r.integrity)throw new z("add-to-cache-list-conflicting-integrities",{url:a});this._cacheKeysToIntegrities.set(s,r.integrity)}if(this._urlsToCacheKeys.set(a,s),this._urlsToCacheModes.set(a,i),n.length>0){const o=`Workbox is precaching URLs without revision info: ${n.join(", ")}
This is generally NOT safe. Learn more at https://bit.ly/wb-precache`;console.warn(o)}}}install(e){return En(e,async()=>{const n=new Rr;this.strategy.plugins.push(n);for(const[a,i]of this._urlsToCacheKeys){const o=this._cacheKeysToIntegrities.get(i),c=this._urlsToCacheModes.get(a),l=new Request(a,{integrity:o,cache:c,credentials:"same-origin"});await Promise.all(this.strategy.handleAll({params:{cacheKey:i},request:l,event:e}))}const{updatedURLs:r,notUpdatedURLs:s}=n;return{updatedURLs:r,notUpdatedURLs:s}})}activate(e){return En(e,async()=>{const n=await self.caches.open(this.strategy.cacheName),r=await n.keys(),s=new Set(this._urlsToCacheKeys.values()),a=[];for(const i of r)s.has(i.url)||(await n.delete(i),a.push(i.url));return{deletedURLs:a}})}getURLsToCacheKeys(){return this._urlsToCacheKeys}getCachedURLs(){return[...this._urlsToCacheKeys.keys()]}getCacheKeyForURL(e){const n=new URL(e,location.href);return this._urlsToCacheKeys.get(n.href)}getIntegrityForCacheKey(e){return this._cacheKeysToIntegrities.get(e)}async matchPrecache(e){const n=e instanceof Request?e.url:e,r=this.getCacheKeyForURL(n);if(r)return(await self.caches.open(this.strategy.cacheName)).match(r)}createHandlerBoundToURL(e){const n=this.getCacheKeyForURL(e);if(!n)throw new z("non-precached-url",{url:e});return r=>(r.request=new Request(e),r.params=Object.assign({cacheKey:n},r.params),this.strategy.handle(r))}}let At;const pn=()=>(At||(At=new Br),At);try{self["workbox:routing:7.0.0"]&&_()}catch{}const qn="GET",wt=t=>t&&typeof t=="object"?t:{handle:t};class Se{constructor(e,n,r=qn){this.handler=wt(n),this.match=e,this.method=r}setCatchHandler(e){this.catchHandler=wt(e)}}class Lr extends Se{constructor(e,n,r){const s=({url:a})=>{const i=e.exec(a.href);if(i&&!(a.origin!==location.origin&&i.index!==0))return i.slice(1)};super(s,n,r)}}class Ur{constructor(){this._routes=new Map,this._defaultHandlerMap=new Map}get routes(){return this._routes}addFetchListener(){self.addEventListener("fetch",e=>{const{request:n}=e,r=this.handleRequest({request:n,event:e});r&&e.respondWith(r)})}addCacheListener(){self.addEventListener("message",e=>{if(e.data&&e.data.type==="CACHE_URLS"){const{payload:n}=e.data,r=Promise.all(n.urlsToCache.map(s=>{typeof s=="string"&&(s=[s]);const a=new Request(...s);return this.handleRequest({request:a,event:e})}));e.waitUntil(r),e.ports&&e.ports[0]&&r.then(()=>e.ports[0].postMessage(!0))}})}handleRequest({request:e,event:n}){const r=new URL(e.url,location.href);if(!r.protocol.startsWith("http"))return;const s=r.origin===location.origin,{params:a,route:i}=this.findMatchingRoute({event:n,request:e,sameOrigin:s,url:r});let o=i&&i.handler;const c=e.method;if(!o&&this._defaultHandlerMap.has(c)&&(o=this._defaultHandlerMap.get(c)),!o)return;let l;try{l=o.handle({url:r,request:e,event:n,params:a})}catch(d){l=Promise.reject(d)}const u=i&&i.catchHandler;return l instanceof Promise&&(this._catchHandler||u)&&(l=l.catch(async d=>{if(u)try{return await u.handle({url:r,request:e,event:n,params:a})}catch(h){h instanceof Error&&(d=h)}if(this._catchHandler)return this._catchHandler.handle({url:r,request:e,event:n});throw d})),l}findMatchingRoute({url:e,sameOrigin:n,request:r,event:s}){const a=this._routes.get(r.method)||[];for(const i of a){let o;const c=i.match({url:e,sameOrigin:n,request:r,event:s});if(c)return o=c,(Array.isArray(o)&&o.length===0||c.constructor===Object&&Object.keys(c).length===0||typeof c=="boolean")&&(o=void 0),{route:i,params:o}}return{}}setDefaultHandler(e,n=qn){this._defaultHandlerMap.set(n,wt(e))}setCatchHandler(e){this._catchHandler=wt(e)}registerRoute(e){this._routes.has(e.method)||this._routes.set(e.method,[]),this._routes.get(e.method).push(e)}unregisterRoute(e){if(!this._routes.has(e.method))throw new z("unregister-route-but-not-found-with-method",{method:e.method});const n=this._routes.get(e.method).indexOf(e);if(n>-1)this._routes.get(e.method).splice(n,1);else throw new z("unregister-route-route-not-registered")}}let Ue;const Mr=()=>(Ue||(Ue=new Ur,Ue.addFetchListener(),Ue.addCacheListener()),Ue);function T(t,e,n){let r;if(typeof t=="string"){const a=new URL(t,location.href),i=({url:o})=>o.href===a.href;r=new Se(i,e,n)}else if(t instanceof RegExp)r=new Lr(t,e,n);else if(typeof t=="function")r=new Se(t,e,n);else if(t instanceof Se)r=t;else throw new z("unsupported-route-type",{moduleName:"workbox-routing",funcName:"registerRoute",paramName:"capture"});return Mr().registerRoute(r),r}function qr(t,e=[]){for(const n of[...t.searchParams.keys()])e.some(r=>r.test(n))&&t.searchParams.delete(n);return t}function*Fr(t,{ignoreURLParametersMatching:e=[/^utm_/,/^fbclid$/],directoryIndex:n="index.html",cleanURLs:r=!0,urlManipulation:s}={}){const a=new URL(t,location.href);a.hash="",yield a.href;const i=qr(a,e);if(yield i.href,n&&i.pathname.endsWith("/")){const o=new URL(i.href);o.pathname+=n,yield o.href}if(r){const o=new URL(i.href);o.pathname+=".html",yield o.href}if(s){const o=s({url:a});for(const c of o)yield c.href}}class $r extends Se{constructor(e,n){const r=({request:s})=>{const a=e.getURLsToCacheKeys();for(const i of Fr(s.url,n)){const o=a.get(i);if(o){const c=e.getIntegrityForCacheKey(o);return{cacheKey:o,integrity:c}}}};super(r,e.strategy)}}function Wr(t){const e=pn(),n=new $r(e,t);T(n)}const Hr="-precache-",Gr=async(t,e=Hr)=>{const r=(await self.caches.keys()).filter(s=>s.includes(e)&&s.includes(self.registration.scope)&&s!==t);return await Promise.all(r.map(s=>self.caches.delete(s))),r};function Vr(){self.addEventListener("activate",t=>{const e=It.getPrecacheName();t.waitUntil(Gr(e).then(n=>{}))})}function Jr(t){return pn().createHandlerBoundToURL(t)}function zr(t){pn().precache(t)}function Yr(t,e){zr(t),Wr(e)}function Qr(){self.addEventListener("activate",()=>self.clients.claim())}class Xr extends Se{constructor(e,{allowlist:n=[/./],denylist:r=[]}={}){super(s=>this._match(s),e),this._allowlist=n,this._denylist=r}_match({url:e,request:n}){if(n&&n.mode!=="navigate")return!1;const r=e.pathname+e.search;for(const s of this._denylist)if(s.test(r))return!1;return!!this._allowlist.some(s=>s.test(r))}}const N=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,M=Object.keys,W=Array.isArray;function V(t,e){return typeof e!="object"||M(e).forEach(function(n){t[n]=e[n]}),t}typeof Promise>"u"||N.Promise||(N.Promise=Promise);const Je=Object.getPrototypeOf,Zr={}.hasOwnProperty;function Q(t,e){return Zr.call(t,e)}function Ae(t,e){typeof e=="function"&&(e=e(Je(t))),(typeof Reflect>"u"?M:Reflect.ownKeys)(e).forEach(n=>{ie(t,n,e[n])})}const Fn=Object.defineProperty;function ie(t,e,n,r){Fn(t,e,V(n&&Q(n,"get")&&typeof n.get=="function"?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function Ke(t){return{from:function(e){return t.prototype=Object.create(e.prototype),ie(t.prototype,"constructor",t),{extend:Ae.bind(null,t.prototype)}}}}const es=Object.getOwnPropertyDescriptor;function mn(t,e){let n;return es(t,e)||(n=Je(t))&&mn(n,e)}const ts=[].slice;function vt(t,e,n){return ts.call(t,e,n)}function $n(t,e){return e(t)}function qe(t){if(!t)throw new Error("Assertion Failed")}function Wn(t){N.setImmediate?setImmediate(t):setTimeout(t,0)}function Hn(t,e){return t.reduce((n,r,s)=>{var a=e(r,s);return a&&(n[a[0]]=a[1]),n},{})}function oe(t,e){if(typeof e=="string"&&Q(t,e))return t[e];if(!e)return t;if(typeof e!="string"){for(var n=[],r=0,s=e.length;r<s;++r){var a=oe(t,e[r]);n.push(a)}return n}var i=e.indexOf(".");if(i!==-1){var o=t[e.substr(0,i)];return o==null?void 0:oe(o,e.substr(i+1))}}function X(t,e,n){if(t&&e!==void 0&&(!("isFrozen"in Object)||!Object.isFrozen(t)))if(typeof e!="string"&&"length"in e){qe(typeof n!="string"&&"length"in n);for(var r=0,s=e.length;r<s;++r)X(t,e[r],n[r])}else{var a=e.indexOf(".");if(a!==-1){var i=e.substr(0,a),o=e.substr(a+1);if(o==="")n===void 0?W(t)&&!isNaN(parseInt(i))?t.splice(i,1):delete t[i]:t[i]=n;else{var c=t[i];c&&Q(t,i)||(c=t[i]={}),X(c,o,n)}}else n===void 0?W(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=n}}function Gn(t){var e={};for(var n in t)Q(t,n)&&(e[n]=t[n]);return e}const ns=[].concat;function Vn(t){return ns.apply([],t)}const Jn="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Vn([8,16,32,64].map(t=>["Int","Uint","Float"].map(e=>e+t+"Array")))).filter(t=>N[t]),rs=Jn.map(t=>N[t]);Hn(Jn,t=>[t,!0]);let ue=null;function tt(t){ue=typeof WeakMap<"u"&&new WeakMap;const e=Ft(t);return ue=null,e}function Ft(t){if(!t||typeof t!="object")return t;let e=ue&&ue.get(t);if(e)return e;if(W(t)){e=[],ue&&ue.set(t,e);for(var n=0,r=t.length;n<r;++n)e.push(Ft(t[n]))}else if(rs.indexOf(t.constructor)>=0)e=t;else{const a=Je(t);for(var s in e=a===Object.prototype?{}:Object.create(a),ue&&ue.set(t,e),t)Q(t,s)&&(e[s]=Ft(t[s]))}return e}const{toString:ss}={};function $t(t){return ss.call(t).slice(8,-1)}const Wt=typeof Symbol<"u"?Symbol.iterator:"@@iterator",as=typeof Wt=="symbol"?function(t){var e;return t!=null&&(e=t[Wt])&&e.apply(t)}:function(){return null},Ie={};function se(t){var e,n,r,s;if(arguments.length===1){if(W(t))return t.slice();if(this===Ie&&typeof t=="string")return[t];if(s=as(t)){for(n=[];!(r=s.next()).done;)n.push(r.value);return n}if(t==null)return[t];if(typeof(e=t.length)=="number"){for(n=new Array(e);e--;)n[e]=t[e];return n}return[t]}for(e=arguments.length,n=new Array(e);e--;)n[e]=arguments[e];return n}const yn=typeof Symbol<"u"?t=>t[Symbol.toStringTag]==="AsyncFunction":()=>!1;var ee=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function zn(t,e){ee=t,Yn=e}var Yn=()=>!0;const is=!new Error("").stack;function Pe(){if(is)try{throw Pe.arguments,new Error}catch(t){return t}return new Error}function Ht(t,e){var n=t.stack;return n?(e=e||0,n.indexOf(t.name)===0&&(e+=(t.name+t.message).split(`
`).length),n.split(`
`).slice(e).filter(Yn).map(r=>`
`+r).join("")):""}var Qn=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],gn=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Qn),os={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Oe(t,e){this._e=Pe(),this.name=t,this.message=e}function Xn(t,e){return t+". Errors: "+Object.keys(e).map(n=>e[n].toString()).filter((n,r,s)=>s.indexOf(n)===r).join(`
`)}function _t(t,e,n,r){this._e=Pe(),this.failures=e,this.failedKeys=r,this.successCount=n,this.message=Xn(t,e)}function $e(t,e){this._e=Pe(),this.name="BulkError",this.failures=Object.keys(e).map(n=>e[n]),this.failuresByPos=e,this.message=Xn(t,e)}Ke(Oe).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+Ht(this._e,2))}},toString:function(){return this.name+": "+this.message}}),Ke(_t).from(Oe),Ke($e).from(Oe);var bn=gn.reduce((t,e)=>(t[e]=e+"Error",t),{});const cs=Oe;var S=gn.reduce((t,e)=>{var n=e+"Error";function r(s,a){this._e=Pe(),this.name=n,s?typeof s=="string"?(this.message=`${s}${a?`
 `+a:""}`,this.inner=a||null):typeof s=="object"&&(this.message=`${s.name} ${s.message}`,this.inner=s):(this.message=os[e]||n,this.inner=null)}return Ke(r).from(cs),t[e]=r,t},{});S.Syntax=SyntaxError,S.Type=TypeError,S.Range=RangeError;var In=Qn.reduce((t,e)=>(t[e+"Error"]=S[e],t),{}),dt=gn.reduce((t,e)=>(["Syntax","Type","Range"].indexOf(e)===-1&&(t[e+"Error"]=S[e]),t),{});function D(){}function ze(t){return t}function ls(t,e){return t==null||t===ze?e:function(n){return e(t(n))}}function ke(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function us(t,e){return t===D?e:function(){var n=t.apply(this,arguments);n!==void 0&&(arguments[0]=n);var r=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var a=e.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?ke(r,this.onsuccess):r),s&&(this.onerror=this.onerror?ke(s,this.onerror):s),a!==void 0?a:n}}function hs(t,e){return t===D?e:function(){t.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?ke(n,this.onsuccess):n),r&&(this.onerror=this.onerror?ke(r,this.onerror):r)}}function ds(t,e){return t===D?e:function(n){var r=t.apply(this,arguments);V(n,r);var s=this.onsuccess,a=this.onerror;this.onsuccess=null,this.onerror=null;var i=e.apply(this,arguments);return s&&(this.onsuccess=this.onsuccess?ke(s,this.onsuccess):s),a&&(this.onerror=this.onerror?ke(a,this.onerror):a),r===void 0?i===void 0?void 0:i:V(r,i)}}function fs(t,e){return t===D?e:function(){return e.apply(this,arguments)!==!1&&t.apply(this,arguments)}}function wn(t,e){return t===D?e:function(){var n=t.apply(this,arguments);if(n&&typeof n.then=="function"){for(var r=this,s=arguments.length,a=new Array(s);s--;)a[s]=arguments[s];return n.then(function(){return e.apply(r,a)})}return e.apply(this,arguments)}}dt.ModifyError=_t,dt.DexieError=Oe,dt.BulkError=$e;var Ye={};const Zn=100,[Gt,kt,Vt]=typeof Promise>"u"?[]:(()=>{let t=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[t,Je(t),t];const e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,Je(e),t]})(),er=kt&&kt.then,ft=Gt&&Gt.constructor,vn=!!Vt;var Jt=!1,ps=Vt?()=>{Vt.then(at)}:N.setImmediate?setImmediate.bind(null,at):N.MutationObserver?()=>{var t=document.createElement("div");new MutationObserver(()=>{at(),t=null}).observe(t,{attributes:!0}),t.setAttribute("i","1")}:()=>{setTimeout(at,0)},We=function(t,e){Fe.push([t,e]),xt&&(ps(),xt=!1)},zt=!0,xt=!0,we=[],pt=[],Yt=null,Qt=ze,Te={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:On,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(t=>{try{On(t[0],t[1])}catch{}})}},I=Te,Fe=[],ve=0,mt=[];function C(t){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=D,this._lib=!1;var e=this._PSD=I;if(ee&&(this._stackHolder=Pe(),this._prev=null,this._numPrev=0),typeof t!="function"){if(t!==Ye)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Zt(this,this._value))}this._state=null,this._value=null,++e.ref,nr(this,t)}const Xt={get:function(){var t=I,e=Pt;function n(r,s){var a=!t.global&&(t!==I||e!==Pt);const i=a&&!ce();var o=new C((c,l)=>{_n(this,new tr(Rt(r,t,a,i),Rt(s,t,a,i),c,l,t))});return ee&&ar(o,this),o}return n.prototype=Ye,n},set:function(t){ie(this,"then",t&&t.prototype===Ye?Xt:{get:function(){return t},set:Xt.set})}};function tr(t,e,n,r,s){this.onFulfilled=typeof t=="function"?t:null,this.onRejected=typeof e=="function"?e:null,this.resolve=n,this.reject=r,this.psd=s}function nr(t,e){try{e(n=>{if(t._state===null){if(n===t)throw new TypeError("A promise cannot be resolved with itself.");var r=t._lib&&nt();n&&typeof n.then=="function"?nr(t,(s,a)=>{n instanceof C?n._then(s,a):n.then(s,a)}):(t._state=!0,t._value=n,rr(t)),r&&rt()}},Zt.bind(null,t))}catch(n){Zt(t,n)}}function Zt(t,e){if(pt.push(e),t._state===null){var n=t._lib&&nt();e=Qt(e),t._state=!1,t._value=e,ee&&e!==null&&typeof e=="object"&&!e._promise&&function(r,s,a){try{r.apply(null,a)}catch(i){s&&s(i)}}(()=>{var r=mn(e,"stack");e._promise=t,ie(e,"stack",{get:()=>Jt?r&&(r.get?r.get.apply(e):r.value):t.stack})}),function(r){we.some(s=>s._value===r._value)||we.push(r)}(t),rr(t),n&&rt()}}function rr(t){var e=t._listeners;t._listeners=[];for(var n=0,r=e.length;n<r;++n)_n(t,e[n]);var s=t._PSD;--s.ref||s.finalize(),ve===0&&(++ve,We(()=>{--ve==0&&kn()},[]))}function _n(t,e){if(t._state!==null){var n=t._state?e.onFulfilled:e.onRejected;if(n===null)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++ve,We(ms,[n,t,e])}else t._listeners.push(e)}function ms(t,e,n){try{Yt=e;var r,s=e._value;e._state?r=t(s):(pt.length&&(pt=[]),r=t(s),pt.indexOf(s)===-1&&function(a){for(var i=we.length;i;)if(we[--i]._value===a._value)return void we.splice(i,1)}(e)),n.resolve(r)}catch(a){n.reject(a)}finally{Yt=null,--ve==0&&kn(),--n.psd.ref||n.psd.finalize()}}function sr(t,e,n){if(e.length===n)return e;var r="";if(t._state===!1){var s,a,i=t._value;i!=null?(s=i.name||"Error",a=i.message||i,r=Ht(i,0)):(s=i,a=""),e.push(s+(a?": "+a:"")+r)}return ee&&((r=Ht(t._stackHolder,2))&&e.indexOf(r)===-1&&e.push(r),t._prev&&sr(t._prev,e,n)),e}function ar(t,e){var n=e?e._numPrev+1:0;n<100&&(t._prev=e,t._numPrev=n)}function at(){nt()&&rt()}function nt(){var t=zt;return zt=!1,xt=!1,t}function rt(){var t,e,n;do for(;Fe.length>0;)for(t=Fe,Fe=[],n=t.length,e=0;e<n;++e){var r=t[e];r[0].apply(null,r[1])}while(Fe.length>0);zt=!0,xt=!0}function kn(){var t=we;we=[],t.forEach(r=>{r._PSD.onunhandled.call(null,r._value,r)});for(var e=mt.slice(0),n=e.length;n;)e[--n]()}function it(t){return new C(Ye,!1,t)}function B(t,e){var n=I;return function(){var r=nt(),s=I;try{return pe(n,!0),t.apply(this,arguments)}catch(a){e&&e(a)}finally{pe(s,!1),r&&rt()}}}Ae(C.prototype,{then:Xt,_then:function(t,e){_n(this,new tr(null,null,t,e,I))},catch:function(t){if(arguments.length===1)return this.then(null,t);var e=arguments[0],n=arguments[1];return typeof e=="function"?this.then(null,r=>r instanceof e?n(r):it(r)):this.then(null,r=>r&&r.name===e?n(r):it(r))},finally:function(t){return this.then(e=>(t(),e),e=>(t(),it(e)))},stack:{get:function(){if(this._stack)return this._stack;try{Jt=!0;var t=sr(this,[],20).join(`
From previous: `);return this._state!==null&&(this._stack=t),t}finally{Jt=!1}}},timeout:function(t,e){return t<1/0?new C((n,r)=>{var s=setTimeout(()=>r(new S.Timeout(e)),t);this.then(n,r).finally(clearTimeout.bind(null,s))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&ie(C.prototype,Symbol.toStringTag,"Dexie.Promise"),Te.env=ir(),Ae(C,{all:function(){var t=se.apply(null,arguments).map(ot);return new C(function(e,n){t.length===0&&e([]);var r=t.length;t.forEach((s,a)=>C.resolve(s).then(i=>{t[a]=i,--r||e(t)},n))})},resolve:t=>{if(t instanceof C)return t;if(t&&typeof t.then=="function")return new C((n,r)=>{t.then(n,r)});var e=new C(Ye,!0,t);return ar(e,Yt),e},reject:it,race:function(){var t=se.apply(null,arguments).map(ot);return new C((e,n)=>{t.map(r=>C.resolve(r).then(e,n))})},PSD:{get:()=>I,set:t=>I=t},totalEchoes:{get:()=>Pt},newPSD:fe,usePSD:Ne,scheduler:{get:()=>We,set:t=>{We=t}},rejectionMapper:{get:()=>Qt,set:t=>{Qt=t}},follow:(t,e)=>new C((n,r)=>fe((s,a)=>{var i=I;i.unhandleds=[],i.onunhandled=a,i.finalize=ke(function(){(function(o){function c(){o(),mt.splice(mt.indexOf(c),1)}mt.push(c),++ve,We(()=>{--ve==0&&kn()},[])})(()=>{this.unhandleds.length===0?s():a(this.unhandleds[0])})},i.finalize),t()},e,n,r))}),ft&&(ft.allSettled&&ie(C,"allSettled",function(){const t=se.apply(null,arguments).map(ot);return new C(e=>{t.length===0&&e([]);let n=t.length;const r=new Array(n);t.forEach((s,a)=>C.resolve(s).then(i=>r[a]={status:"fulfilled",value:i},i=>r[a]={status:"rejected",reason:i}).then(()=>--n||e(r)))})}),ft.any&&typeof AggregateError<"u"&&ie(C,"any",function(){const t=se.apply(null,arguments).map(ot);return new C((e,n)=>{t.length===0&&n(new AggregateError([]));let r=t.length;const s=new Array(r);t.forEach((a,i)=>C.resolve(a).then(o=>e(o),o=>{s[i]=o,--r||n(new AggregateError(s))}))})}));const $={awaits:0,echoes:0,id:0};var ys=0,yt=[],Dt=0,Pt=0,gs=0;function fe(t,e,n,r){var s=I,a=Object.create(s);a.parent=s,a.ref=0,a.global=!1,a.id=++gs;var i=Te.env;a.env=vn?{Promise:C,PromiseProp:{value:C,configurable:!0,writable:!0},all:C.all,race:C.race,allSettled:C.allSettled,any:C.any,resolve:C.resolve,reject:C.reject,nthen:Sn(i.nthen,a),gthen:Sn(i.gthen,a)}:{},e&&V(a,e),++s.ref,a.finalize=function(){--this.parent.ref||this.parent.finalize()};var o=Ne(a,t,n,r);return a.ref===0&&a.finalize(),o}function De(){return $.id||($.id=++ys),++$.awaits,$.echoes+=Zn,$.id}function ce(){return!!$.awaits&&(--$.awaits==0&&($.id=0),$.echoes=$.awaits*Zn,!0)}function ot(t){return $.echoes&&t&&t.constructor===ft?(De(),t.then(e=>(ce(),e),e=>(ce(),q(e)))):t}function bs(t){++Pt,$.echoes&&--$.echoes!=0||($.echoes=$.id=0),yt.push(I),pe(t,!0)}function ws(){var t=yt[yt.length-1];yt.pop(),pe(t,!1)}function pe(t,e){var n=I;if((e?!$.echoes||Dt++&&t===I:!Dt||--Dt&&t===I)||or(e?bs.bind(null,t):ws),t!==I&&(I=t,n===Te&&(Te.env=ir()),vn)){var r=Te.env.Promise,s=t.env;kt.then=s.nthen,r.prototype.then=s.gthen,(n.global||t.global)&&(Object.defineProperty(N,"Promise",s.PromiseProp),r.all=s.all,r.race=s.race,r.resolve=s.resolve,r.reject=s.reject,s.allSettled&&(r.allSettled=s.allSettled),s.any&&(r.any=s.any))}}function ir(){var t=N.Promise;return vn?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(N,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject,nthen:kt.then,gthen:t.prototype.then}:{}}function Ne(t,e,n,r,s){var a=I;try{return pe(t,!0),e(n,r,s)}finally{pe(a,!1)}}function or(t){er.call(Gt,t)}function Rt(t,e,n,r){return typeof t!="function"?t:function(){var s=I;n&&De(),pe(e,!0);try{return t.apply(this,arguments)}finally{pe(s,!1),r&&or(ce)}}}function Sn(t,e){return function(n,r){return t.call(this,Rt(n,e),Rt(r,e))}}(""+er).indexOf("[native code]")===-1&&(De=ce=D);const Kn="unhandledrejection";function On(t,e){var n;try{n=e.onuncatched(t)}catch{}if(n!==!1)try{var r,s={promise:e,reason:t};if(N.document&&document.createEvent?((r=document.createEvent("Event")).initEvent(Kn,!0,!0),V(r,s)):N.CustomEvent&&V(r=new CustomEvent(Kn,{detail:s}),s),r&&N.dispatchEvent&&(dispatchEvent(r),!N.PromiseRejectionEvent&&N.onunhandledrejection))try{N.onunhandledrejection(r)}catch{}ee&&r&&!r.defaultPrevented&&console.warn(`Unhandled rejection: ${t.stack||t}`)}catch{}}var q=C.reject;function en(t,e,n,r){if(t.idbdb&&(t._state.openComplete||I.letThrough||t._vip)){var s=t._createTransaction(e,n,t._dbSchema);try{s.create(),t._state.PR1398_maxLoop=3}catch(a){return a.name===bn.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>en(t,e,n,r))):q(a)}return s._promise(e,(a,i)=>fe(()=>(I.trans=s,r(a,i,s)))).then(a=>s._completion.then(()=>a))}if(t._state.openComplete)return q(new S.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._options.autoOpen)return q(new S.DatabaseClosed);t.open().catch(D)}return t._state.dbReadyPromise.then(()=>en(t,e,n,r))}const Tn="3.2.6",be="￿",tn=-1/0,te="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",cr="String expected.",He=[],St=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),vs=St,_s=St,lr=t=>!/(dexie\.js|dexie\.min\.js)/.test(t),Kt="__dbnames",Nt="readonly",Bt="readwrite";function xe(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}const ur={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function ct(t){return typeof t!="string"||/\./.test(t)?e=>e:e=>(e[t]===void 0&&t in e&&delete(e=tt(e))[t],e)}class ks{_trans(e,n,r){const s=this._tx||I.trans,a=this.name;function i(c,l,u){if(!u.schema[a])throw new S.NotFound("Table "+a+" not part of transaction");return n(u.idbtrans,u)}const o=nt();try{return s&&s.db===this.db?s===I.trans?s._promise(e,i,r):fe(()=>s._promise(e,i,r),{trans:s,transless:I.transless||I}):en(this.db,e,[this.name],i)}finally{o&&rt()}}get(e,n){return e&&e.constructor===Object?this.where(e).first(n):this._trans("readonly",r=>this.core.get({trans:r,key:e}).then(s=>this.hook.reading.fire(s))).then(n)}where(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(W(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);const n=M(e);if(n.length===1)return this.where(n[0]).equals(e[n[0]]);const r=this.schema.indexes.concat(this.schema.primKey).filter(l=>{if(l.compound&&n.every(u=>l.keyPath.indexOf(u)>=0)){for(let u=0;u<n.length;++u)if(n.indexOf(l.keyPath[u])===-1)return!1;return!0}return!1}).sort((l,u)=>l.keyPath.length-u.keyPath.length)[0];if(r&&this.db._maxKey!==be){const l=r.keyPath.slice(0,n.length);return this.where(l).equals(l.map(u=>e[u]))}!r&&ee&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${n.join("+")}]`);const{idxByName:s}=this.schema,a=this.db._deps.indexedDB;function i(l,u){try{return a.cmp(l,u)===0}catch{return!1}}const[o,c]=n.reduce(([l,u],d)=>{const h=s[d],f=e[d];return[l||h,l||!h?xe(u,h&&h.multi?g=>{const m=oe(g,d);return W(m)&&m.some(b=>i(f,b))}:g=>i(f,oe(g,d))):u]},[null,null]);return o?this.where(o.name).equals(e[o.keyPath]).filter(c):r?this.filter(c):this.where(n).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,W(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){this.schema.mappedClass=e;const n=r=>{if(!r)return r;const s=Object.create(e.prototype);for(var a in r)if(Q(r,a))try{s[a]=r[a]}catch{}return s};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=n,this.hook("reading",n),e}defineClass(){return this.mapToClass(function(e){V(this,e)})}add(e,n){const{auto:r,keyPath:s}=this.schema.primKey;let a=e;return s&&r&&(a=ct(s)(e)),this._trans("readwrite",i=>this.core.mutate({trans:i,type:"add",keys:n!=null?[n]:null,values:[a]})).then(i=>i.numFailures?C.reject(i.failures[0]):i.lastResult).then(i=>{if(s)try{X(e,s,i)}catch{}return i})}update(e,n){if(typeof e!="object"||W(e))return this.where(":id").equals(e).modify(n);{const r=oe(e,this.schema.primKey.keyPath);if(r===void 0)return q(new S.InvalidArgument("Given object does not contain its primary key"));try{typeof n!="function"?M(n).forEach(s=>{X(e,s,n[s])}):n(e,{value:e,primKey:r})}catch{}return this.where(":id").equals(r).modify(n)}}put(e,n){const{auto:r,keyPath:s}=this.schema.primKey;let a=e;return s&&r&&(a=ct(s)(e)),this._trans("readwrite",i=>this.core.mutate({trans:i,type:"put",values:[a],keys:n!=null?[n]:null})).then(i=>i.numFailures?C.reject(i.failures[0]):i.lastResult).then(i=>{if(s)try{X(e,s,i)}catch{}return i})}delete(e){return this._trans("readwrite",n=>this.core.mutate({trans:n,type:"delete",keys:[e]})).then(n=>n.numFailures?C.reject(n.failures[0]):void 0)}clear(){return this._trans("readwrite",e=>this.core.mutate({trans:e,type:"deleteRange",range:ur})).then(e=>e.numFailures?C.reject(e.failures[0]):void 0)}bulkGet(e){return this._trans("readonly",n=>this.core.getMany({keys:e,trans:n}).then(r=>r.map(s=>this.hook.reading.fire(s))))}bulkAdd(e,n,r){const s=Array.isArray(n)?n:void 0,a=(r=r||(s?void 0:n))?r.allKeys:void 0;return this._trans("readwrite",i=>{const{auto:o,keyPath:c}=this.schema.primKey;if(c&&s)throw new S.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(s&&s.length!==e.length)throw new S.InvalidArgument("Arguments objects and keys must have the same length");const l=e.length;let u=c&&o?e.map(ct(c)):e;return this.core.mutate({trans:i,type:"add",keys:s,values:u,wantResults:a}).then(({numFailures:d,results:h,lastResult:f,failures:g})=>{if(d===0)return a?h:f;throw new $e(`${this.name}.bulkAdd(): ${d} of ${l} operations failed`,g)})})}bulkPut(e,n,r){const s=Array.isArray(n)?n:void 0,a=(r=r||(s?void 0:n))?r.allKeys:void 0;return this._trans("readwrite",i=>{const{auto:o,keyPath:c}=this.schema.primKey;if(c&&s)throw new S.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(s&&s.length!==e.length)throw new S.InvalidArgument("Arguments objects and keys must have the same length");const l=e.length;let u=c&&o?e.map(ct(c)):e;return this.core.mutate({trans:i,type:"put",keys:s,values:u,wantResults:a}).then(({numFailures:d,results:h,lastResult:f,failures:g})=>{if(d===0)return a?h:f;throw new $e(`${this.name}.bulkPut(): ${d} of ${l} operations failed`,g)})})}bulkDelete(e){const n=e.length;return this._trans("readwrite",r=>this.core.mutate({trans:r,type:"delete",keys:e})).then(({numFailures:r,lastResult:s,failures:a})=>{if(r===0)return s;throw new $e(`${this.name}.bulkDelete(): ${r} of ${n} operations failed`,a)})}}function Ge(t){var e={},n=function(i,o){if(o){for(var c=arguments.length,l=new Array(c-1);--c;)l[c-1]=arguments[c];return e[i].subscribe.apply(null,l),t}if(typeof i=="string")return e[i]};n.addEventType=a;for(var r=1,s=arguments.length;r<s;++r)a(arguments[r]);return n;function a(i,o,c){if(typeof i!="object"){var l;o||(o=fs),c||(c=D);var u={subscribers:[],fire:c,subscribe:function(d){u.subscribers.indexOf(d)===-1&&(u.subscribers.push(d),u.fire=o(u.fire,d))},unsubscribe:function(d){u.subscribers=u.subscribers.filter(function(h){return h!==d}),u.fire=u.subscribers.reduce(o,c)}};return e[i]=n[i]=u,u}M(l=i).forEach(function(d){var h=l[d];if(W(h))a(d,l[d][0],l[d][1]);else{if(h!=="asap")throw new S.InvalidArgument("Invalid event config");var f=a(d,ze,function(){for(var g=arguments.length,m=new Array(g);g--;)m[g]=arguments[g];f.subscribers.forEach(function(b){Wn(function(){b.apply(null,m)})})})}})}}function Me(t,e){return Ke(e).from({prototype:t}),e}function Ee(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function Lt(t,e){t.filter=xe(t.filter,e)}function Ut(t,e,n){var r=t.replayFilter;t.replayFilter=r?()=>xe(r(),e()):e,t.justLimit=n&&!r}function gt(t,e){if(t.isPrimKey)return e.primaryKey;const n=e.getIndexByKeyPath(t.index);if(!n)throw new S.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return n}function An(t,e,n){const r=gt(t,e.schema);return e.openCursor({trans:n,values:!t.keysOnly,reverse:t.dir==="prev",unique:!!t.unique,query:{index:r,range:t.range}})}function lt(t,e,n,r){const s=t.replayFilter?xe(t.filter,t.replayFilter()):t.filter;if(t.or){const a={},i=(o,c,l)=>{if(!s||s(c,l,h=>c.stop(h),h=>c.fail(h))){var u=c.primaryKey,d=""+u;d==="[object ArrayBuffer]"&&(d=""+new Uint8Array(u)),Q(a,d)||(a[d]=!0,e(o,c,l))}};return Promise.all([t.or._iterate(i,n),Dn(An(t,r,n),t.algorithm,i,!t.keysOnly&&t.valueMapper)])}return Dn(An(t,r,n),xe(t.algorithm,s),e,!t.keysOnly&&t.valueMapper)}function Dn(t,e,n,r){var s=B(r?(a,i,o)=>n(r(a),i,o):n);return t.then(a=>{if(a)return a.start(()=>{var i=()=>a.continue();e&&!e(a,o=>i=o,o=>{a.stop(o),i=D},o=>{a.fail(o),i=D})||s(a.value,a,o=>i=o),i()})})}function G(t,e){try{const n=Nn(t),r=Nn(e);if(n!==r)return n==="Array"?1:r==="Array"?-1:n==="binary"?1:r==="binary"?-1:n==="string"?1:r==="string"?-1:n==="Date"?1:r!=="Date"?NaN:-1;switch(n){case"number":case"Date":case"string":return t>e?1:t<e?-1:0;case"binary":return function(s,a){const i=s.length,o=a.length,c=i<o?i:o;for(let l=0;l<c;++l)if(s[l]!==a[l])return s[l]<a[l]?-1:1;return i===o?0:i<o?-1:1}(Bn(t),Bn(e));case"Array":return function(s,a){const i=s.length,o=a.length,c=i<o?i:o;for(let l=0;l<c;++l){const u=G(s[l],a[l]);if(u!==0)return u}return i===o?0:i<o?-1:1}(t,e)}}catch{}return NaN}function Nn(t){const e=typeof t;if(e!=="object")return e;if(ArrayBuffer.isView(t))return"binary";const n=$t(t);return n==="ArrayBuffer"?"binary":n}function Bn(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}class xs{_read(e,n){var r=this._ctx;return r.error?r.table._trans(null,q.bind(null,r.error)):r.table._trans("readonly",e).then(n)}_write(e){var n=this._ctx;return n.error?n.table._trans(null,q.bind(null,n.error)):n.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var n=this._ctx;n.algorithm=xe(n.algorithm,e)}_iterate(e,n){return lt(this._ctx,e,n,this._ctx.table.core)}clone(e){var n=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return e&&V(r,e),n._ctx=r,n}raw(){return this._ctx.valueMapper=null,this}each(e){var n=this._ctx;return this._read(r=>lt(n,e,r,n.table.core))}count(e){return this._read(n=>{const r=this._ctx,s=r.table.core;if(Ee(r,!0))return s.count({trans:n,query:{index:gt(r,s.schema),range:r.range}}).then(i=>Math.min(i,r.limit));var a=0;return lt(r,()=>(++a,!1),n,s).then(()=>a)}).then(e)}sortBy(e,n){const r=e.split(".").reverse(),s=r[0],a=r.length-1;function i(l,u){return u?i(l[r[u]],u-1):l[s]}var o=this._ctx.dir==="next"?1:-1;function c(l,u){var d=i(l,a),h=i(u,a);return d<h?-o:d>h?o:0}return this.toArray(function(l){return l.sort(c)}).then(n)}toArray(e){return this._read(n=>{var r=this._ctx;if(r.dir==="next"&&Ee(r,!0)&&r.limit>0){const{valueMapper:s}=r,a=gt(r,r.table.core.schema);return r.table.core.query({trans:n,limit:r.limit,values:!0,query:{index:a,range:r.range}}).then(({result:i})=>s?i.map(s):i)}{const s=[];return lt(r,a=>s.push(a),n,r.table.core).then(()=>s)}},e)}offset(e){var n=this._ctx;return e<=0||(n.offset+=e,Ee(n)?Ut(n,()=>{var r=e;return(s,a)=>r===0||(r===1?(--r,!1):(a(()=>{s.advance(r),r=0}),!1))}):Ut(n,()=>{var r=e;return()=>--r<0})),this}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Ut(this._ctx,()=>{var n=e;return function(r,s,a){return--n<=0&&s(a),n>=0}},!0),this}until(e,n){return Lt(this._ctx,function(r,s,a){return!e(r.value)||(s(a),n)}),this}first(e){return this.limit(1).toArray(function(n){return n[0]}).then(e)}last(e){return this.reverse().first(e)}filter(e){var n,r;return Lt(this._ctx,function(s){return e(s.value)}),n=this._ctx,r=e,n.isMatch=xe(n.isMatch,r),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,s){e(s.key,s)})}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,s){e(s.primaryKey,s)})}keys(e){var n=this._ctx;n.keysOnly=!n.isMatch;var r=[];return this.each(function(s,a){r.push(a.key)}).then(function(){return r}).then(e)}primaryKeys(e){var n=this._ctx;if(n.dir==="next"&&Ee(n,!0)&&n.limit>0)return this._read(s=>{var a=gt(n,n.table.core.schema);return n.table.core.query({trans:s,values:!1,limit:n.limit,query:{index:a,range:n.range}})}).then(({result:s})=>s).then(e);n.keysOnly=!n.isMatch;var r=[];return this.each(function(s,a){r.push(a.primaryKey)}).then(function(){return r}).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys(function(n){return n[0]}).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,n=e.index&&e.table.schema.idxByName[e.index];if(!n||!n.multi)return this;var r={};return Lt(this._ctx,function(s){var a=s.primaryKey.toString(),i=Q(r,a);return r[a]=!0,!i}),this}modify(e){var n=this._ctx;return this._write(r=>{var s;if(typeof e=="function")s=e;else{var a=M(e),i=a.length;s=function(m){for(var b=!1,y=0;y<i;++y){var p=a[y],k=e[p];oe(m,p)!==k&&(X(m,p,k),b=!0)}return b}}const o=n.table.core,{outbound:c,extractKey:l}=o.schema.primaryKey,u=this.db._options.modifyChunkSize||200,d=[];let h=0;const f=[],g=(m,b)=>{const{failures:y,numFailures:p}=b;h+=m-p;for(let k of M(y))d.push(y[k])};return this.clone().primaryKeys().then(m=>{const b=y=>{const p=Math.min(u,m.length-y);return o.getMany({trans:r,keys:m.slice(y,y+p),cache:"immutable"}).then(k=>{const R=[],E=[],P=c?[]:null,v=[];for(let x=0;x<p;++x){const L=k[x],A={value:tt(L),primKey:m[y+x]};s.call(A,A.value,A)!==!1&&(A.value==null?v.push(m[y+x]):c||G(l(L),l(A.value))===0?(E.push(A.value),c&&P.push(m[y+x])):(v.push(m[y+x]),R.push(A.value)))}const K=Ee(n)&&n.limit===1/0&&(typeof e!="function"||e===Mt)&&{index:n.index,range:n.range};return Promise.resolve(R.length>0&&o.mutate({trans:r,type:"add",values:R}).then(x=>{for(let L in x.failures)v.splice(parseInt(L),1);g(R.length,x)})).then(()=>(E.length>0||K&&typeof e=="object")&&o.mutate({trans:r,type:"put",keys:P,values:E,criteria:K,changeSpec:typeof e!="function"&&e}).then(x=>g(E.length,x))).then(()=>(v.length>0||K&&e===Mt)&&o.mutate({trans:r,type:"delete",keys:v,criteria:K}).then(x=>g(v.length,x))).then(()=>m.length>y+p&&b(y+u))})};return b(0).then(()=>{if(d.length>0)throw new _t("Error modifying one or more objects",d,h,f);return m.length})})})}delete(){var e=this._ctx,n=e.range;return Ee(e)&&(e.isPrimKey&&!_s||n.type===3)?this._write(r=>{const{primaryKey:s}=e.table.core.schema,a=n;return e.table.core.count({trans:r,query:{index:s,range:a}}).then(i=>e.table.core.mutate({trans:r,type:"deleteRange",range:a}).then(({failures:o,lastResult:c,results:l,numFailures:u})=>{if(u)throw new _t("Could not delete some values",Object.keys(o).map(d=>o[d]),i-u);return i-u}))}):this.modify(Mt)}}const Mt=(t,e)=>e.value=null;function Ps(t,e){return t<e?-1:t===e?0:1}function Rs(t,e){return t>e?-1:t===e?0:1}function Y(t,e,n){var r=t instanceof dr?new t.Collection(t):t;return r._ctx.error=n?new n(e):new TypeError(e),r}function je(t){return new t.Collection(t,()=>hr("")).limit(0)}function Cs(t,e,n,r,s,a){for(var i=Math.min(t.length,r.length),o=-1,c=0;c<i;++c){var l=e[c];if(l!==r[c])return s(t[c],n[c])<0?t.substr(0,c)+n[c]+n.substr(c+1):s(t[c],r[c])<0?t.substr(0,c)+r[c]+n.substr(c+1):o>=0?t.substr(0,o)+e[o]+n.substr(o+1):null;s(t[c],l)<0&&(o=c)}return i<r.length&&a==="next"?t+n.substr(t.length):i<t.length&&a==="prev"?t.substr(0,n.length):o<0?null:t.substr(0,o)+r[o]+n.substr(o+1)}function ut(t,e,n,r){var s,a,i,o,c,l,u,d=n.length;if(!n.every(m=>typeof m=="string"))return Y(t,cr);function h(m){s=function(y){return y==="next"?p=>p.toUpperCase():p=>p.toLowerCase()}(m),a=function(y){return y==="next"?p=>p.toLowerCase():p=>p.toUpperCase()}(m),i=m==="next"?Ps:Rs;var b=n.map(function(y){return{lower:a(y),upper:s(y)}}).sort(function(y,p){return i(y.lower,p.lower)});o=b.map(function(y){return y.upper}),c=b.map(function(y){return y.lower}),l=m,u=m==="next"?"":r}h("next");var f=new t.Collection(t,()=>le(o[0],c[d-1]+r));f._ondirectionchange=function(m){h(m)};var g=0;return f._addAlgorithm(function(m,b,y){var p=m.key;if(typeof p!="string")return!1;var k=a(p);if(e(k,c,g))return!0;for(var R=null,E=g;E<d;++E){var P=Cs(p,k,o[E],c[E],i,l);P===null&&R===null?g=E+1:(R===null||i(R,P)>0)&&(R=P)}return b(R!==null?function(){m.continue(R+u)}:y),!1}),f}function le(t,e,n,r){return{type:2,lower:t,upper:e,lowerOpen:n,upperOpen:r}}function hr(t){return{type:1,lower:t,upper:t}}class dr{get Collection(){return this._ctx.table.db.Collection}between(e,n,r,s){r=r!==!1,s=s===!0;try{return this._cmp(e,n)>0||this._cmp(e,n)===0&&(r||s)&&(!r||!s)?je(this):new this.Collection(this,()=>le(e,n,!r,!s))}catch{return Y(this,te)}}equals(e){return e==null?Y(this,te):new this.Collection(this,()=>hr(e))}above(e){return e==null?Y(this,te):new this.Collection(this,()=>le(e,void 0,!0))}aboveOrEqual(e){return e==null?Y(this,te):new this.Collection(this,()=>le(e,void 0,!1))}below(e){return e==null?Y(this,te):new this.Collection(this,()=>le(void 0,e,!1,!0))}belowOrEqual(e){return e==null?Y(this,te):new this.Collection(this,()=>le(void 0,e))}startsWith(e){return typeof e!="string"?Y(this,cr):this.between(e,e+be,!0,!0)}startsWithIgnoreCase(e){return e===""?this.startsWith(e):ut(this,(n,r)=>n.indexOf(r[0])===0,[e],be)}equalsIgnoreCase(e){return ut(this,(n,r)=>n===r[0],[e],"")}anyOfIgnoreCase(){var e=se.apply(Ie,arguments);return e.length===0?je(this):ut(this,(n,r)=>r.indexOf(n)!==-1,e,"")}startsWithAnyOfIgnoreCase(){var e=se.apply(Ie,arguments);return e.length===0?je(this):ut(this,(n,r)=>r.some(s=>n.indexOf(s)===0),e,be)}anyOf(){const e=se.apply(Ie,arguments);let n=this._cmp;try{e.sort(n)}catch{return Y(this,te)}if(e.length===0)return je(this);const r=new this.Collection(this,()=>le(e[0],e[e.length-1]));r._ondirectionchange=a=>{n=a==="next"?this._ascending:this._descending,e.sort(n)};let s=0;return r._addAlgorithm((a,i,o)=>{const c=a.key;for(;n(c,e[s])>0;)if(++s,s===e.length)return i(o),!1;return n(c,e[s])===0||(i(()=>{a.continue(e[s])}),!1)}),r}notEqual(e){return this.inAnyRange([[tn,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const e=se.apply(Ie,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return Y(this,te)}const n=e.reduce((r,s)=>r?r.concat([[r[r.length-1][1],s]]):[[tn,s]],null);return n.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(n,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,n){const r=this._cmp,s=this._ascending,a=this._descending,i=this._min,o=this._max;if(e.length===0)return je(this);if(!e.every(p=>p[0]!==void 0&&p[1]!==void 0&&s(p[0],p[1])<=0))return Y(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",S.InvalidArgument);const c=!n||n.includeLowers!==!1,l=n&&n.includeUppers===!0;let u,d=s;function h(p,k){return d(p[0],k[0])}try{u=e.reduce(function(p,k){let R=0,E=p.length;for(;R<E;++R){const P=p[R];if(r(k[0],P[1])<0&&r(k[1],P[0])>0){P[0]=i(P[0],k[0]),P[1]=o(P[1],k[1]);break}}return R===E&&p.push(k),p},[]),u.sort(h)}catch{return Y(this,te)}let f=0;const g=l?p=>s(p,u[f][1])>0:p=>s(p,u[f][1])>=0,m=c?p=>a(p,u[f][0])>0:p=>a(p,u[f][0])>=0;let b=g;const y=new this.Collection(this,()=>le(u[0][0],u[u.length-1][1],!c,!l));return y._ondirectionchange=p=>{p==="next"?(b=g,d=s):(b=m,d=a),u.sort(h)},y._addAlgorithm((p,k,R)=>{for(var E=p.key;b(E);)if(++f,f===u.length)return k(R),!1;return!!function(P){return!g(P)&&!m(P)}(E)||(this._cmp(E,u[f][1])===0||this._cmp(E,u[f][0])===0||k(()=>{d===s?p.continue(u[f][0]):p.continue(u[f][1])}),!1)}),y}startsWithAnyOf(){const e=se.apply(Ie,arguments);return e.every(n=>typeof n=="string")?e.length===0?je(this):this.inAnyRange(e.map(n=>[n,n+be])):Y(this,"startsWithAnyOf() only works with strings")}}function Z(t){return B(function(e){return Qe(e),t(e.target.error),!1})}function Qe(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}const Xe="storagemutated",he="x-storagemutated-1",me=Ge(null,Xe);class Es{_lock(){return qe(!I.global),++this._reculock,this._reculock!==1||I.global||(I.lockOwnerFor=this),this}_unlock(){if(qe(!I.global),--this._reculock==0)for(I.global||(I.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{Ne(e[1],e[0])}catch{}}return this}_locked(){return this._reculock&&I.lockOwnerFor!==this}create(e){if(!this.mode)return this;const n=this.db.idbdb,r=this.db._state.dbOpenError;if(qe(!this.idbtrans),!e&&!n)switch(r&&r.name){case"DatabaseClosedError":throw new S.DatabaseClosed(r);case"MissingAPIError":throw new S.MissingAPI(r.message,r);default:throw new S.OpenFailed(r)}if(!this.active)throw new S.TransactionInactive;return qe(this._completion._state===null),(e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):n.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=B(s=>{Qe(s),this._reject(e.error)}),e.onabort=B(s=>{Qe(s),this.active&&this._reject(new S.Abort(e.error)),this.active=!1,this.on("abort").fire(s)}),e.oncomplete=B(()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&me.storagemutated.fire(e.mutatedParts)}),this}_promise(e,n,r){if(e==="readwrite"&&this.mode!=="readwrite")return q(new S.ReadOnly("Transaction is readonly"));if(!this.active)return q(new S.TransactionInactive);if(this._locked())return new C((a,i)=>{this._blockedFuncs.push([()=>{this._promise(e,n,r).then(a,i)},I])});if(r)return fe(()=>{var a=new C((i,o)=>{this._lock();const c=n(i,o,this);c&&c.then&&c.then(i,o)});return a.finally(()=>this._unlock()),a._lib=!0,a});var s=new C((a,i)=>{var o=n(a,i,this);o&&o.then&&o.then(a,i)});return s._lib=!0,s}_root(){return this.parent?this.parent._root():this}waitFor(e){var n=this._root();const r=C.resolve(e);if(n._waitingFor)n._waitingFor=n._waitingFor.then(()=>r);else{n._waitingFor=r,n._waitingQueue=[];var s=n.idbtrans.objectStore(n.storeNames[0]);(function i(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(s.get(-1/0).onsuccess=i)})()}var a=n._waitingFor;return new C((i,o)=>{r.then(c=>n._waitingQueue.push(B(i.bind(null,c))),c=>n._waitingQueue.push(B(o.bind(null,c)))).finally(()=>{n._waitingFor===a&&(n._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new S.Abort))}table(e){const n=this._memoizedTables||(this._memoizedTables={});if(Q(n,e))return n[e];const r=this.schema[e];if(!r)throw new S.NotFound("Table "+e+" not part of transaction");const s=new this.db.Table(e,r,this);return s.core=this.db.core.table(e),n[e]=s,s}}function nn(t,e,n,r,s,a,i){return{name:t,keyPath:e,unique:n,multi:r,auto:s,compound:a,src:(n&&!i?"&":"")+(r?"*":"")+(s?"++":"")+fr(e)}}function fr(t){return typeof t=="string"?t:t?"["+[].join.call(t,"+")+"]":""}function pr(t,e,n){return{name:t,primKey:e,indexes:n,mappedClass:null,idxByName:Hn(n,r=>[r.name,r])}}let Ze=t=>{try{return t.only([[]]),Ze=()=>[[]],[[]]}catch{return Ze=()=>be,be}};function rn(t){return t==null?()=>{}:typeof t=="string"?function(e){return e.split(".").length===1?r=>r[e]:r=>oe(r,e)}(t):e=>oe(e,t)}function Ln(t){return[].slice.call(t)}let js=0;function Ve(t){return t==null?":id":typeof t=="string"?t:`[${t.join("+")}]`}function Is(t,e,n){function r(c){if(c.type===3)return null;if(c.type===4)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:l,upper:u,lowerOpen:d,upperOpen:h}=c;return l===void 0?u===void 0?null:e.upperBound(u,!!h):u===void 0?e.lowerBound(l,!!d):e.bound(l,u,!!d,!!h)}const{schema:s,hasGetAll:a}=function(c,l){const u=Ln(c.objectStoreNames);return{schema:{name:c.name,tables:u.map(d=>l.objectStore(d)).map(d=>{const{keyPath:h,autoIncrement:f}=d,g=W(h),m=h==null,b={},y={name:d.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:m,compound:g,keyPath:h,autoIncrement:f,unique:!0,extractKey:rn(h)},indexes:Ln(d.indexNames).map(p=>d.index(p)).map(p=>{const{name:k,unique:R,multiEntry:E,keyPath:P}=p,v={name:k,compound:W(P),keyPath:P,unique:R,multiEntry:E,extractKey:rn(P)};return b[Ve(P)]=v,v}),getIndexByKeyPath:p=>b[Ve(p)]};return b[":id"]=y.primaryKey,h!=null&&(b[Ve(h)]=y.primaryKey),y})},hasGetAll:u.length>0&&"getAll"in l.objectStore(u[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(t,n),i=s.tables.map(c=>function(l){const u=l.name;return{name:u,schema:l,mutate:function({trans:d,type:h,keys:f,values:g,range:m}){return new Promise((b,y)=>{b=B(b);const p=d.objectStore(u),k=p.keyPath==null,R=h==="put"||h==="add";if(!R&&h!=="delete"&&h!=="deleteRange")throw new Error("Invalid operation type: "+h);const{length:E}=f||g||{length:1};if(f&&g&&f.length!==g.length)throw new Error("Given keys array must have same length as given values array.");if(E===0)return b({numFailures:0,failures:{},results:[],lastResult:void 0});let P;const v=[],K=[];let x=0;const L=H=>{++x,Qe(H)};if(h==="deleteRange"){if(m.type===4)return b({numFailures:x,failures:K,results:[],lastResult:void 0});m.type===3?v.push(P=p.clear()):v.push(P=p.delete(r(m)))}else{const[H,F]=R?k?[g,f]:[g,null]:[f,null];if(R)for(let U=0;U<E;++U)v.push(P=F&&F[U]!==void 0?p[h](H[U],F[U]):p[h](H[U])),P.onerror=L;else for(let U=0;U<E;++U)v.push(P=p[h](H[U])),P.onerror=L}const A=H=>{const F=H.target.result;v.forEach((U,Re)=>U.error!=null&&(K[Re]=U.error)),b({numFailures:x,failures:K,results:h==="delete"?f:v.map(U=>U.result),lastResult:F})};P.onerror=H=>{L(H),A(H)},P.onsuccess=A})},getMany:({trans:d,keys:h})=>new Promise((f,g)=>{f=B(f);const m=d.objectStore(u),b=h.length,y=new Array(b);let p,k=0,R=0;const E=v=>{const K=v.target;y[K._pos]=K.result,++R===k&&f(y)},P=Z(g);for(let v=0;v<b;++v)h[v]!=null&&(p=m.get(h[v]),p._pos=v,p.onsuccess=E,p.onerror=P,++k);k===0&&f(y)}),get:({trans:d,key:h})=>new Promise((f,g)=>{f=B(f);const m=d.objectStore(u).get(h);m.onsuccess=b=>f(b.target.result),m.onerror=Z(g)}),query:function(d){return h=>new Promise((f,g)=>{f=B(f);const{trans:m,values:b,limit:y,query:p}=h,k=y===1/0?void 0:y,{index:R,range:E}=p,P=m.objectStore(u),v=R.isPrimaryKey?P:P.index(R.name),K=r(E);if(y===0)return f({result:[]});if(d){const x=b?v.getAll(K,k):v.getAllKeys(K,k);x.onsuccess=L=>f({result:L.target.result}),x.onerror=Z(g)}else{let x=0;const L=b||!("openKeyCursor"in v)?v.openCursor(K):v.openKeyCursor(K),A=[];L.onsuccess=H=>{const F=L.result;return F?(A.push(b?F.value:F.primaryKey),++x===y?f({result:A}):void F.continue()):f({result:A})},L.onerror=Z(g)}})}(a),openCursor:function({trans:d,values:h,query:f,reverse:g,unique:m}){return new Promise((b,y)=>{b=B(b);const{index:p,range:k}=f,R=d.objectStore(u),E=p.isPrimaryKey?R:R.index(p.name),P=g?m?"prevunique":"prev":m?"nextunique":"next",v=h||!("openKeyCursor"in E)?E.openCursor(r(k),P):E.openKeyCursor(r(k),P);v.onerror=Z(y),v.onsuccess=B(K=>{const x=v.result;if(!x)return void b(null);x.___id=++js,x.done=!1;const L=x.continue.bind(x);let A=x.continuePrimaryKey;A&&(A=A.bind(x));const H=x.advance.bind(x),F=()=>{throw new Error("Cursor not stopped")};x.trans=d,x.stop=x.continue=x.continuePrimaryKey=x.advance=()=>{throw new Error("Cursor not started")},x.fail=B(y),x.next=function(){let U=1;return this.start(()=>U--?this.continue():this.stop()).then(()=>this)},x.start=U=>{const Re=new Promise((J,ye)=>{J=B(J),v.onerror=Z(ye),x.fail=ye,x.stop=Be=>{x.stop=x.continue=x.continuePrimaryKey=x.advance=F,J(Be)}}),Ce=()=>{if(v.result)try{U()}catch(J){x.fail(J)}else x.done=!0,x.start=()=>{throw new Error("Cursor behind last entry")},x.stop()};return v.onsuccess=B(J=>{v.onsuccess=Ce,Ce()}),x.continue=L,x.continuePrimaryKey=A,x.advance=H,Ce(),Re},b(x)},y)})},count({query:d,trans:h}){const{index:f,range:g}=d;return new Promise((m,b)=>{const y=h.objectStore(u),p=f.isPrimaryKey?y:y.index(f.name),k=r(g),R=k?p.count(k):p.count();R.onsuccess=B(E=>m(E.target.result)),R.onerror=Z(b)})}}}(c)),o={};return i.forEach(c=>o[c.name]=c),{stack:"dbcore",transaction:t.transaction.bind(t),table(c){if(!o[c])throw new Error(`Table '${c}' not found`);return o[c]},MIN_KEY:-1/0,MAX_KEY:Ze(e),schema:s}}function sn({_novip:t},e){const n=e.db,r=function(s,a,{IDBKeyRange:i,indexedDB:o},c){return{dbcore:function(u,d){return d.reduce((h,{create:f})=>({...h,...f(h)}),u)}(Is(a,i,c),s.dbcore)}}(t._middlewares,n,t._deps,e);t.core=r.dbcore,t.tables.forEach(s=>{const a=s.name;t.core.schema.tables.some(i=>i.name===a)&&(s.core=t.core.table(a),t[a]instanceof t.Table&&(t[a].core=s.core))})}function Ct({_novip:t},e,n,r){n.forEach(s=>{const a=r[s];e.forEach(i=>{const o=mn(i,s);(!o||"value"in o&&o.value===void 0)&&(i===t.Transaction.prototype||i instanceof t.Transaction?ie(i,s,{get(){return this.table(s)},set(c){Fn(this,s,{value:c,writable:!0,configurable:!0,enumerable:!0})}}):i[s]=new t.Table(s,a))})})}function an({_novip:t},e){e.forEach(n=>{for(let r in n)n[r]instanceof t.Table&&delete n[r]})}function Ss(t,e){return t._cfg.version-e._cfg.version}function Ks(t,e,n,r){const s=t._dbSchema,a=t._createTransaction("readwrite",t._storeNames,s);a.create(n),a._completion.catch(r);const i=a._reject.bind(a),o=I.transless||I;fe(()=>{I.trans=a,I.transless=o,e===0?(M(s).forEach(c=>{qt(n,c,s[c].primKey,s[c].indexes)}),sn(t,n),C.follow(()=>t.on.populate.fire(a)).catch(i)):function({_novip:c},l,u,d){const h=[],f=c._versions;let g=c._dbSchema=cn(c,c.idbdb,d),m=!1;const b=f.filter(p=>p._cfg.version>=l);function y(){return h.length?C.resolve(h.shift()(u.idbtrans)).then(y):C.resolve()}return b.forEach(p=>{h.push(()=>{const k=g,R=p._cfg.dbschema;ln(c,k,d),ln(c,R,d),g=c._dbSchema=R;const E=mr(k,R);E.add.forEach(v=>{qt(d,v[0],v[1].primKey,v[1].indexes)}),E.change.forEach(v=>{if(v.recreate)throw new S.Upgrade("Not yet support for changing primary key");{const K=d.objectStore(v.name);v.add.forEach(x=>on(K,x)),v.change.forEach(x=>{K.deleteIndex(x.name),on(K,x)}),v.del.forEach(x=>K.deleteIndex(x))}});const P=p._cfg.contentUpgrade;if(P&&p._cfg.version>l){sn(c,d),u._memoizedTables={},m=!0;let v=Gn(R);E.del.forEach(A=>{v[A]=k[A]}),an(c,[c.Transaction.prototype]),Ct(c,[c.Transaction.prototype],M(v),v),u.schema=v;const K=yn(P);let x;K&&De();const L=C.follow(()=>{if(x=P(u),x&&K){var A=ce.bind(null,null);x.then(A,A)}});return x&&typeof x.then=="function"?C.resolve(x):L.then(()=>x)}}),h.push(k=>{(!m||!vs)&&function(R,E){[].slice.call(E.db.objectStoreNames).forEach(P=>R[P]==null&&E.db.deleteObjectStore(P))}(p._cfg.dbschema,k),an(c,[c.Transaction.prototype]),Ct(c,[c.Transaction.prototype],c._storeNames,c._dbSchema),u.schema=c._dbSchema})}),y().then(()=>{var p,k;k=d,M(p=g).forEach(R=>{k.db.objectStoreNames.contains(R)||qt(k,R,p[R].primKey,p[R].indexes)})})}(t,e,a,n).catch(i)})}function mr(t,e){const n={del:[],add:[],change:[]};let r;for(r in t)e[r]||n.del.push(r);for(r in e){const s=t[r],a=e[r];if(s){const i={name:r,def:a,recreate:!1,del:[],add:[],change:[]};if(""+(s.primKey.keyPath||"")!=""+(a.primKey.keyPath||"")||s.primKey.auto!==a.primKey.auto&&!St)i.recreate=!0,n.change.push(i);else{const o=s.idxByName,c=a.idxByName;let l;for(l in o)c[l]||i.del.push(l);for(l in c){const u=o[l],d=c[l];u?u.src!==d.src&&i.change.push(d):i.add.push(d)}(i.del.length>0||i.add.length>0||i.change.length>0)&&n.change.push(i)}}else n.add.push([r,a])}return n}function qt(t,e,n,r){const s=t.db.createObjectStore(e,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(a=>on(s,a)),s}function on(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function cn(t,e,n){const r={};return vt(e.objectStoreNames,0).forEach(s=>{const a=n.objectStore(s);let i=a.keyPath;const o=nn(fr(i),i||"",!1,!1,!!a.autoIncrement,i&&typeof i!="string",!0),c=[];for(let u=0;u<a.indexNames.length;++u){const d=a.index(a.indexNames[u]);i=d.keyPath;var l=nn(d.name,i,!!d.unique,!!d.multiEntry,!1,i&&typeof i!="string",!1);c.push(l)}r[s]=pr(s,o,c)}),r}function ln({_novip:t},e,n){const r=n.db.objectStoreNames;for(let s=0;s<r.length;++s){const a=r[s],i=n.objectStore(a);t._hasGetAll="getAll"in i;for(let o=0;o<i.indexNames.length;++o){const c=i.indexNames[o],l=i.index(c).keyPath,u=typeof l=="string"?l:"["+vt(l).join("+")+"]";if(e[a]){const d=e[a].idxByName[u];d&&(d.name=c,delete e[a].idxByName[u],e[a].idxByName[c]=d)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&N.WorkerGlobalScope&&N instanceof N.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(t._hasGetAll=!1)}class Os{_parseStoresSpec(e,n){M(e).forEach(r=>{if(e[r]!==null){var s=e[r].split(",").map((i,o)=>{const c=(i=i.trim()).replace(/([&*]|\+\+)/g,""),l=/^\[/.test(c)?c.match(/^\[(.*)\]$/)[1].split("+"):c;return nn(c,l||null,/\&/.test(i),/\*/.test(i),/\+\+/.test(i),W(l),o===0)}),a=s.shift();if(a.multi)throw new S.Schema("Primary key cannot be multi-valued");s.forEach(i=>{if(i.auto)throw new S.Schema("Only primary key can be marked as autoIncrement (++)");if(!i.keyPath)throw new S.Schema("Index must have a name and cannot be an empty string")}),n[r]=pr(r,a,s)}})}stores(e){const n=this.db;this._cfg.storesSource=this._cfg.storesSource?V(this._cfg.storesSource,e):e;const r=n._versions,s={};let a={};return r.forEach(i=>{V(s,i._cfg.storesSource),a=i._cfg.dbschema={},i._parseStoresSpec(s,a)}),n._dbSchema=a,an(n,[n._allTables,n,n.Transaction.prototype]),Ct(n,[n._allTables,n,n.Transaction.prototype,this._cfg.tables],M(a),a),n._storeNames=M(a),this}upgrade(e){return this._cfg.contentUpgrade=wn(this._cfg.contentUpgrade||D,e),this}}function xn(t,e){let n=t._dbNamesDB;return n||(n=t._dbNamesDB=new _e(Kt,{addons:[],indexedDB:t,IDBKeyRange:e}),n.version(1).stores({dbnames:"name"})),n.table("dbnames")}function Pn(t){return t&&typeof t.databases=="function"}function un(t){return fe(function(){return I.letThrough=!0,t()})}function Ts(){var t;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(e){var n=function(){return indexedDB.databases().finally(e)};t=setInterval(n,100),n()}).finally(function(){return clearInterval(t)}):Promise.resolve()}function As(t){const e=t._state,{indexedDB:n}=t._deps;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then(()=>e.dbOpenError?q(e.dbOpenError):t);ee&&(e.openCanceller._stackHolder=Pe()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;const r=e.openCanceller;function s(){if(e.openCanceller!==r)throw new S.DatabaseClosed("db.open() was cancelled")}let a=e.dbReadyResolve,i=null,o=!1;const c=()=>new C((l,u)=>{if(s(),!n)throw new S.MissingAPI;const d=t.name,h=e.autoSchema?n.open(d):n.open(d,Math.round(10*t.verno));if(!h)throw new S.MissingAPI;h.onerror=Z(u),h.onblocked=B(t._fireOnBlocked),h.onupgradeneeded=B(f=>{if(i=h.transaction,e.autoSchema&&!t._options.allowEmptyDB){h.onerror=Qe,i.abort(),h.result.close();const m=n.deleteDatabase(d);m.onsuccess=m.onerror=B(()=>{u(new S.NoSuchDatabase(`Database ${d} doesnt exist`))})}else{i.onerror=Z(u);var g=f.oldVersion>Math.pow(2,62)?0:f.oldVersion;o=g<1,t._novip.idbdb=h.result,Ks(t,g/10,i,u)}},u),h.onsuccess=B(()=>{i=null;const f=t._novip.idbdb=h.result,g=vt(f.objectStoreNames);if(g.length>0)try{const b=f.transaction((m=g).length===1?m[0]:m,"readonly");e.autoSchema?function({_novip:y},p,k){y.verno=p.version/10;const R=y._dbSchema=cn(0,p,k);y._storeNames=vt(p.objectStoreNames,0),Ct(y,[y._allTables],M(R),R)}(t,f,b):(ln(t,t._dbSchema,b),function(y,p){const k=mr(cn(0,y.idbdb,p),y._dbSchema);return!(k.add.length||k.change.some(R=>R.add.length||R.change.length))}(t,b)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),sn(t,b)}catch{}var m;He.push(t),f.onversionchange=B(b=>{e.vcFired=!0,t.on("versionchange").fire(b)}),f.onclose=B(b=>{t.on("close").fire(b)}),o&&function({indexedDB:b,IDBKeyRange:y},p){!Pn(b)&&p!==Kt&&xn(b,y).put({name:p}).catch(D)}(t._deps,d),l()},u)}).catch(l=>l&&l.name==="UnknownError"&&e.PR1398_maxLoop>0?(e.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),c()):C.reject(l));return C.race([r,(typeof navigator>"u"?C.resolve():Ts()).then(c)]).then(()=>(s(),e.onReadyBeingFired=[],C.resolve(un(()=>t.on.ready.fire(t.vip))).then(function l(){if(e.onReadyBeingFired.length>0){let u=e.onReadyBeingFired.reduce(wn,D);return e.onReadyBeingFired=[],C.resolve(un(()=>u(t.vip))).then(l)}}))).finally(()=>{e.onReadyBeingFired=null,e.isBeingOpened=!1}).then(()=>t).catch(l=>{e.dbOpenError=l;try{i&&i.abort()}catch{}return r===e.openCanceller&&t._close(),q(l)}).finally(()=>{e.openComplete=!0,a()})}function hn(t){var e=a=>t.next(a),n=s(e),r=s(a=>t.throw(a));function s(a){return i=>{var o=a(i),c=o.value;return o.done?c:c&&typeof c.then=="function"?c.then(n,r):W(c)?Promise.all(c).then(n,r):n(c)}}return s(e)()}function Ds(t,e,n){var r=arguments.length;if(r<2)throw new S.InvalidArgument("Too few arguments");for(var s=new Array(r-1);--r;)s[r-1]=arguments[r];return n=s.pop(),[t,Vn(s),n]}function yr(t,e,n,r,s){return C.resolve().then(()=>{const a=I.transless||I,i=t._createTransaction(e,n,t._dbSchema,r),o={trans:i,transless:a};if(r)i.idbtrans=r.idbtrans;else try{i.create(),t._state.PR1398_maxLoop=3}catch(d){return d.name===bn.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>yr(t,e,n,null,s))):q(d)}const c=yn(s);let l;c&&De();const u=C.follow(()=>{if(l=s.call(i,i),l)if(c){var d=ce.bind(null,null);l.then(d,d)}else typeof l.next=="function"&&typeof l.throw=="function"&&(l=hn(l))},o);return(l&&typeof l.then=="function"?C.resolve(l).then(d=>i.active?d:q(new S.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):u.then(()=>l)).then(d=>(r&&i._resolve(),i._completion.then(()=>d))).catch(d=>(i._reject(d),q(d)))})}function ht(t,e,n){const r=W(t)?t.slice():[t];for(let s=0;s<n;++s)r.push(e);return r}const Ns={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(t){return{...t,table(e){const n=t.table(e),{schema:r}=n,s={},a=[];function i(u,d,h){const f=Ve(u),g=s[f]=s[f]||[],m=u==null?0:typeof u=="string"?1:u.length,b=d>0,y={...h,isVirtual:b,keyTail:d,keyLength:m,extractKey:rn(u),unique:!b&&h.unique};return g.push(y),y.isPrimaryKey||a.push(y),m>1&&i(m===2?u[0]:u.slice(0,m-1),d+1,h),g.sort((p,k)=>p.keyTail-k.keyTail),y}const o=i(r.primaryKey.keyPath,0,r.primaryKey);s[":id"]=[o];for(const u of r.indexes)i(u.keyPath,0,u);function c(u){const d=u.query.index;return d.isVirtual?{...u,query:{index:d,range:(h=u.query.range,f=d.keyTail,{type:h.type===1?2:h.type,lower:ht(h.lower,h.lowerOpen?t.MAX_KEY:t.MIN_KEY,f),lowerOpen:!0,upper:ht(h.upper,h.upperOpen?t.MIN_KEY:t.MAX_KEY,f),upperOpen:!0})}}:u;var h,f}return{...n,schema:{...r,primaryKey:o,indexes:a,getIndexByKeyPath:function(u){const d=s[Ve(u)];return d&&d[0]}},count:u=>n.count(c(u)),query:u=>n.query(c(u)),openCursor(u){const{keyTail:d,isVirtual:h,keyLength:f}=u.query.index;return h?n.openCursor(c(u)).then(g=>g&&function(m){return Object.create(m,{continue:{value:function(y){y!=null?m.continue(ht(y,u.reverse?t.MAX_KEY:t.MIN_KEY,d)):u.unique?m.continue(m.key.slice(0,f).concat(u.reverse?t.MIN_KEY:t.MAX_KEY,d)):m.continue()}},continuePrimaryKey:{value(y,p){m.continuePrimaryKey(ht(y,t.MAX_KEY,d),p)}},primaryKey:{get:()=>m.primaryKey},key:{get(){const y=m.key;return f===1?y[0]:y.slice(0,f)}},value:{get:()=>m.value}})}(g)):n.openCursor(u)}}}}}};function Rn(t,e,n,r){return n=n||{},r=r||"",M(t).forEach(s=>{if(Q(e,s)){var a=t[s],i=e[s];if(typeof a=="object"&&typeof i=="object"&&a&&i){const o=$t(a);o!==$t(i)?n[r+s]=e[s]:o==="Object"?Rn(a,i,n,r+s+"."):a!==i&&(n[r+s]=e[s])}else a!==i&&(n[r+s]=e[s])}else n[r+s]=void 0}),M(e).forEach(s=>{Q(t,s)||(n[r+s]=e[s])}),n}const Bs={stack:"dbcore",name:"HooksMiddleware",level:2,create:t=>({...t,table(e){const n=t.table(e),{primaryKey:r}=n.schema;return{...n,mutate(a){const i=I.trans,{deleting:o,creating:c,updating:l}=i.table(e).hook;switch(a.type){case"add":if(c.fire===D)break;return i._promise("readwrite",()=>u(a),!0);case"put":if(c.fire===D&&l.fire===D)break;return i._promise("readwrite",()=>u(a),!0);case"delete":if(o.fire===D)break;return i._promise("readwrite",()=>u(a),!0);case"deleteRange":if(o.fire===D)break;return i._promise("readwrite",()=>function(h){return d(h.trans,h.range,1e4)}(a),!0)}return n.mutate(a);function u(h){const f=I.trans,g=h.keys||function(m,b){return b.type==="delete"?b.keys:b.keys||b.values.map(m.extractKey)}(r,h);if(!g)throw new Error("Keys missing");return(h=h.type==="add"||h.type==="put"?{...h,keys:g}:{...h}).type!=="delete"&&(h.values=[...h.values]),h.keys&&(h.keys=[...h.keys]),function(m,b,y){return b.type==="add"?Promise.resolve([]):m.getMany({trans:b.trans,keys:y,cache:"immutable"})}(n,h,g).then(m=>{const b=g.map((y,p)=>{const k=m[p],R={onerror:null,onsuccess:null};if(h.type==="delete")o.fire.call(R,y,k,f);else if(h.type==="add"||k===void 0){const E=c.fire.call(R,y,h.values[p],f);y==null&&E!=null&&(y=E,h.keys[p]=y,r.outbound||X(h.values[p],r.keyPath,y))}else{const E=Rn(k,h.values[p]),P=l.fire.call(R,E,y,k,f);if(P){const v=h.values[p];Object.keys(P).forEach(K=>{Q(v,K)?v[K]=P[K]:X(v,K,P[K])})}}return R});return n.mutate(h).then(({failures:y,results:p,numFailures:k,lastResult:R})=>{for(let E=0;E<g.length;++E){const P=p?p[E]:g[E],v=b[E];P==null?v.onerror&&v.onerror(y[E]):v.onsuccess&&v.onsuccess(h.type==="put"&&m[E]?h.values[E]:P)}return{failures:y,results:p,numFailures:k,lastResult:R}}).catch(y=>(b.forEach(p=>p.onerror&&p.onerror(y)),Promise.reject(y)))})}function d(h,f,g){return n.query({trans:h,values:!1,query:{index:r,range:f},limit:g}).then(({result:m})=>u({type:"delete",keys:m,trans:h}).then(b=>b.numFailures>0?Promise.reject(b.failures[0]):m.length<g?{failures:[],numFailures:0,lastResult:void 0}:d(h,{...f,lower:m[m.length-1],lowerOpen:!0},g)))}}}}})};function gr(t,e,n){try{if(!e||e.keys.length<t.length)return null;const r=[];for(let s=0,a=0;s<e.keys.length&&a<t.length;++s)G(e.keys[s],t[a])===0&&(r.push(n?tt(e.values[s]):e.values[s]),++a);return r.length===t.length?r:null}catch{return null}}const Ls={stack:"dbcore",level:-1,create:t=>({table:e=>{const n=t.table(e);return{...n,getMany:r=>{if(!r.cache)return n.getMany(r);const s=gr(r.keys,r.trans._cache,r.cache==="clone");return s?C.resolve(s):n.getMany(r).then(a=>(r.trans._cache={keys:r.keys,values:r.cache==="clone"?tt(a):a},a))},mutate:r=>(r.type!=="add"&&(r.trans._cache=null),n.mutate(r))}}})};function Cn(t){return!("from"in t)}const re=function(t,e){if(!this){const n=new re;return t&&"d"in t&&V(n,t),n}V(this,arguments.length?{d:1,from:t,to:arguments.length>1?e:t}:{d:0})};function et(t,e,n){const r=G(e,n);if(isNaN(r))return;if(r>0)throw RangeError();if(Cn(t))return V(t,{from:e,to:n,d:1});const s=t.l,a=t.r;if(G(n,t.from)<0)return s?et(s,e,n):t.l={from:e,to:n,d:1,l:null,r:null},Un(t);if(G(e,t.to)>0)return a?et(a,e,n):t.r={from:e,to:n,d:1,l:null,r:null},Un(t);G(e,t.from)<0&&(t.from=e,t.l=null,t.d=a?a.d+1:1),G(n,t.to)>0&&(t.to=n,t.r=null,t.d=t.l?t.l.d+1:1);const i=!t.r;s&&!t.l&&Et(t,s),a&&i&&Et(t,a)}function Et(t,e){Cn(e)||function n(r,{from:s,to:a,l:i,r:o}){et(r,s,a),i&&n(r,i),o&&n(r,o)}(t,e)}function Us(t,e){const n=dn(e);let r=n.next();if(r.done)return!1;let s=r.value;const a=dn(t);let i=a.next(s.from),o=i.value;for(;!r.done&&!i.done;){if(G(o.from,s.to)<=0&&G(o.to,s.from)>=0)return!0;G(s.from,o.from)<0?s=(r=n.next(o.from)).value:o=(i=a.next(s.from)).value}return!1}function dn(t){let e=Cn(t)?null:{s:0,n:t};return{next(n){const r=arguments.length>0;for(;e;)switch(e.s){case 0:if(e.s=1,r)for(;e.n.l&&G(n,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!r||G(n,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function Un(t){var e,n;const r=(((e=t.r)===null||e===void 0?void 0:e.d)||0)-(((n=t.l)===null||n===void 0?void 0:n.d)||0),s=r>1?"r":r<-1?"l":"";if(s){const a=s==="r"?"l":"r",i={...t},o=t[s];t.from=o.from,t.to=o.to,t[s]=o[s],i[s]=o[a],t[a]=i,i.d=Mn(i)}t.d=Mn(t)}function Mn({r:t,l:e}){return(t?e?Math.max(t.d,e.d):t.d:e?e.d:0)+1}Ae(re.prototype,{add(t){return Et(this,t),this},addKey(t){return et(this,t,t),this},addKeys(t){return t.forEach(e=>et(this,e,e)),this},[Wt](){return dn(this)}});const Ms={stack:"dbcore",level:0,create:t=>{const e=t.schema.name,n=new re(t.MIN_KEY,t.MAX_KEY);return{...t,table:r=>{const s=t.table(r),{schema:a}=s,{primaryKey:i}=a,{extractKey:o,outbound:c}=i,l={...s,mutate:h=>{const f=h.trans,g=f.mutatedParts||(f.mutatedParts={}),m=P=>{const v=`idb://${e}/${r}/${P}`;return g[v]||(g[v]=new re)},b=m(""),y=m(":dels"),{type:p}=h;let[k,R]=h.type==="deleteRange"?[h.range]:h.type==="delete"?[h.keys]:h.values.length<50?[[],h.values]:[];const E=h.trans._cache;return s.mutate(h).then(P=>{if(W(k)){p!=="delete"&&(k=P.results),b.addKeys(k);const v=gr(k,E);v||p==="add"||y.addKeys(k),(v||R)&&function(K,x,L,A){function H(F){const U=K(F.name||"");function Re(J){return J!=null?F.extractKey(J):null}const Ce=J=>F.multiEntry&&W(J)?J.forEach(ye=>U.addKey(ye)):U.addKey(J);(L||A).forEach((J,ye)=>{const Be=L&&Re(L[ye]),Ot=A&&Re(A[ye]);G(Be,Ot)!==0&&(Be!=null&&Ce(Be),Ot!=null&&Ce(Ot))})}x.indexes.forEach(H)}(m,a,v,R)}else if(k){const v={from:k.lower,to:k.upper};y.add(v),b.add(v)}else b.add(n),y.add(n),a.indexes.forEach(v=>m(v.name).add(n));return P})}},u=({query:{index:h,range:f}})=>{var g,m;return[h,new re((g=f.lower)!==null&&g!==void 0?g:t.MIN_KEY,(m=f.upper)!==null&&m!==void 0?m:t.MAX_KEY)]},d={get:h=>[i,new re(h.key)],getMany:h=>[i,new re().addKeys(h.keys)],count:u,query:u,openCursor:u};return M(d).forEach(h=>{l[h]=function(f){const{subscr:g}=I;if(g){const m=R=>{const E=`idb://${e}/${r}/${R}`;return g[E]||(g[E]=new re)},b=m(""),y=m(":dels"),[p,k]=d[h](f);if(m(p.name||"").add(k),!p.isPrimaryKey){if(h!=="count"){const R=h==="query"&&c&&f.values&&s.query({...f,values:!1});return s[h].apply(this,arguments).then(E=>{if(h==="query"){if(c&&f.values)return R.then(({result:v})=>(b.addKeys(v),E));const P=f.values?E.result.map(o):E.result;f.values?b.addKeys(P):y.addKeys(P)}else if(h==="openCursor"){const P=E,v=f.values;return P&&Object.create(P,{key:{get:()=>(y.addKey(P.primaryKey),P.key)},primaryKey:{get(){const K=P.primaryKey;return y.addKey(K),K}},value:{get:()=>(v&&b.addKey(P.primaryKey),P.value)}})}return E})}y.add(n)}}return s[h].apply(this,arguments)}}),l}}}};class _e{constructor(e,n){this._middlewares={},this.verno=0;const r=_e.dependencies;this._options=n={addons:_e.addons,autoOpen:!0,indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange,...n},this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange};const{addons:s}=n;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const a={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:D,dbReadyPromise:null,cancelOpen:D,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var i;a.dbReadyPromise=new C(o=>{a.dbReadyResolve=o}),a.openCanceller=new C((o,c)=>{a.cancelOpen=c}),this._state=a,this.name=e,this.on=Ge(this,"populate","blocked","versionchange","close",{ready:[wn,D]}),this.on.ready.subscribe=$n(this.on.ready.subscribe,o=>(c,l)=>{_e.vip(()=>{const u=this._state;if(u.openComplete)u.dbOpenError||C.resolve().then(c),l&&o(c);else if(u.onReadyBeingFired)u.onReadyBeingFired.push(c),l&&o(c);else{o(c);const d=this;l||o(function h(){d.on.ready.unsubscribe(c),d.on.ready.unsubscribe(h)})}})}),this.Collection=(i=this,Me(xs.prototype,function(o,c){this.db=i;let l=ur,u=null;if(c)try{l=c()}catch(g){u=g}const d=o._ctx,h=d.table,f=h.hook.reading.fire;this._ctx={table:h,index:d.index,isPrimKey:!d.index||h.schema.primKey.keyPath&&d.index===h.schema.primKey.name,range:l,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:u,or:d.or,valueMapper:f!==ze?f:null}})),this.Table=function(o){return Me(ks.prototype,function(c,l,u){this.db=o,this._tx=u,this.name=c,this.schema=l,this.hook=o._allTables[c]?o._allTables[c].hook:Ge(null,{creating:[us,D],reading:[ls,ze],updating:[ds,D],deleting:[hs,D]})})}(this),this.Transaction=function(o){return Me(Es.prototype,function(c,l,u,d,h){this.db=o,this.mode=c,this.storeNames=l,this.schema=u,this.chromeTransactionDurability=d,this.idbtrans=null,this.on=Ge(this,"complete","error","abort"),this.parent=h||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new C((f,g)=>{this._resolve=f,this._reject=g}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},f=>{var g=this.active;return this.active=!1,this.on.error.fire(f),this.parent?this.parent._reject(f):g&&this.idbtrans&&this.idbtrans.abort(),q(f)})})}(this),this.Version=function(o){return Me(Os.prototype,function(c){this.db=o,this._cfg={version:c,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}(this),this.WhereClause=function(o){return Me(dr.prototype,function(c,l,u){this.db=o,this._ctx={table:c,index:l===":id"?null:l,or:u};const d=o._deps.indexedDB;if(!d)throw new S.MissingAPI;this._cmp=this._ascending=d.cmp.bind(d),this._descending=(h,f)=>d.cmp(f,h),this._max=(h,f)=>d.cmp(h,f)>0?h:f,this._min=(h,f)=>d.cmp(h,f)<0?h:f,this._IDBKeyRange=o._deps.IDBKeyRange})}(this),this.on("versionchange",o=>{o.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",o=>{!o.newVersion||o.newVersion<o.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${o.oldVersion/10}`)}),this._maxKey=Ze(n.IDBKeyRange),this._createTransaction=(o,c,l,u)=>new this.Transaction(o,c,l,this._options.chromeTransactionDurability,u),this._fireOnBlocked=o=>{this.on("blocked").fire(o),He.filter(c=>c.name===this.name&&c!==this&&!c._state.vcFired).map(c=>c.on("versionchange").fire(o))},this.use(Ns),this.use(Bs),this.use(Ms),this.use(Ls),this.vip=Object.create(this,{_vip:{value:!0}}),s.forEach(o=>o(this))}version(e){if(isNaN(e)||e<.1)throw new S.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new S.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);const n=this._versions;var r=n.filter(s=>s._cfg.version===e)[0];return r||(r=new this.Version(e),n.push(r),n.sort(Ss),r.stores({}),this._state.autoSchema=!1,r)}_whenReady(e){return this.idbdb&&(this._state.openComplete||I.letThrough||this._vip)?e():new C((n,r)=>{if(this._state.openComplete)return r(new S.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void r(new S.DatabaseClosed);this.open().catch(D)}this._state.dbReadyPromise.then(n,r)}).then(e)}use({stack:e,create:n,level:r,name:s}){s&&this.unuse({stack:e,name:s});const a=this._middlewares[e]||(this._middlewares[e]=[]);return a.push({stack:e,create:n,level:r??10,name:s}),a.sort((i,o)=>i.level-o.level),this}unuse({stack:e,name:n,create:r}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter(s=>r?s.create!==r:!!n&&s.name!==n)),this}open(){return As(this)}_close(){const e=this._state,n=He.indexOf(this);if(n>=0&&He.splice(n,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}e.dbReadyPromise=new C(r=>{e.dbReadyResolve=r}),e.openCanceller=new C((r,s)=>{e.cancelOpen=s})}close(){this._close();const e=this._state;this._options.autoOpen=!1,e.dbOpenError=new S.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){const e=arguments.length>0,n=this._state;return new C((r,s)=>{const a=()=>{this.close();var i=this._deps.indexedDB.deleteDatabase(this.name);i.onsuccess=B(()=>{(function({indexedDB:o,IDBKeyRange:c},l){!Pn(o)&&l!==Kt&&xn(o,c).delete(l).catch(D)})(this._deps,this.name),r()}),i.onerror=Z(s),i.onblocked=this._fireOnBlocked};if(e)throw new S.InvalidArgument("Arguments not allowed in db.delete()");n.isBeingOpened?n.dbReadyPromise.then(a):a()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){const e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return M(this._allTables).map(e=>this._allTables[e])}transaction(){const e=Ds.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,n,r){let s=I.trans;s&&s.db===this&&e.indexOf("!")===-1||(s=null);const a=e.indexOf("?")!==-1;let i,o;e=e.replace("!","").replace("?","");try{if(o=n.map(l=>{var u=l instanceof this.Table?l.name:l;if(typeof u!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return u}),e=="r"||e===Nt)i=Nt;else{if(e!="rw"&&e!=Bt)throw new S.InvalidArgument("Invalid transaction mode: "+e);i=Bt}if(s){if(s.mode===Nt&&i===Bt){if(!a)throw new S.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");s=null}s&&o.forEach(l=>{if(s&&s.storeNames.indexOf(l)===-1){if(!a)throw new S.SubTransaction("Table "+l+" not included in parent transaction.");s=null}}),a&&s&&!s.active&&(s=null)}}catch(l){return s?s._promise(null,(u,d)=>{d(l)}):q(l)}const c=yr.bind(null,this,i,o,s,r);return s?s._promise(i,c,"lock"):I.trans?Ne(I.transless,()=>this._whenReady(c)):this._whenReady(c)}table(e){if(!Q(this._allTables,e))throw new S.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}}const qs=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable";class Fs{constructor(e){this._subscribe=e}subscribe(e,n,r){return this._subscribe(e&&typeof e!="function"?e:{next:e,error:n,complete:r})}[qs](){return this}}function br(t,e){return M(e).forEach(n=>{Et(t[n]||(t[n]=new re),e[n])}),t}function $s(t){let e,n=!1;const r=new Fs(s=>{const a=yn(t);let i=!1,o={},c={};const l={get closed(){return i},unsubscribe:()=>{i=!0,me.storagemutated.unsubscribe(f)}};s.start&&s.start(l);let u=!1,d=!1;function h(){return M(c).some(m=>o[m]&&Us(o[m],c[m]))}const f=m=>{br(o,m),h()&&g()},g=()=>{if(u||i)return;o={};const m={},b=function(y){a&&De();const p=()=>fe(t,{subscr:y,trans:null}),k=I.trans?Ne(I.transless,p):p();return a&&k.then(ce,ce),k}(m);d||(me(Xe,f),d=!0),u=!0,Promise.resolve(b).then(y=>{n=!0,e=y,u=!1,i||(h()?g():(o={},c=m,s.next&&s.next(y)))},y=>{u=!1,n=!1,s.error&&s.error(y),l.unsubscribe()})};return g(),l});return r.hasValue=()=>n,r.getValue=()=>e,r}let fn;try{fn={indexedDB:N.indexedDB||N.mozIndexedDB||N.webkitIndexedDB||N.msIndexedDB,IDBKeyRange:N.IDBKeyRange||N.webkitIDBKeyRange}}catch{fn={indexedDB:null,IDBKeyRange:null}}const ge=_e;function bt(t){let e=ae;try{ae=!0,me.storagemutated.fire(t)}finally{ae=e}}Ae(ge,{...dt,delete:t=>new ge(t,{addons:[]}).delete(),exists:t=>new ge(t,{addons:[]}).open().then(e=>(e.close(),!0)).catch("NoSuchDatabaseError",()=>!1),getDatabaseNames(t){try{return function({indexedDB:e,IDBKeyRange:n}){return Pn(e)?Promise.resolve(e.databases()).then(r=>r.map(s=>s.name).filter(s=>s!==Kt)):xn(e,n).toCollection().primaryKeys()}(ge.dependencies).then(t)}catch{return q(new S.MissingAPI)}},defineClass:()=>function(t){V(this,t)},ignoreTransaction:t=>I.trans?Ne(I.transless,t):t(),vip:un,async:function(t){return function(){try{var e=hn(t.apply(this,arguments));return e&&typeof e.then=="function"?e:C.resolve(e)}catch(n){return q(n)}}},spawn:function(t,e,n){try{var r=hn(t.apply(n,e||[]));return r&&typeof r.then=="function"?r:C.resolve(r)}catch(s){return q(s)}},currentTransaction:{get:()=>I.trans||null},waitFor:function(t,e){const n=C.resolve(typeof t=="function"?ge.ignoreTransaction(t):t).timeout(e||6e4);return I.trans?I.trans.waitFor(n):n},Promise:C,debug:{get:()=>ee,set:t=>{zn(t,t==="dexie"?()=>!0:lr)}},derive:Ke,extend:V,props:Ae,override:$n,Events:Ge,on:me,liveQuery:$s,extendObservabilitySet:br,getByKeyPath:oe,setByKeyPath:X,delByKeyPath:function(t,e){typeof e=="string"?X(t,e,void 0):"length"in e&&[].map.call(e,function(n){X(t,n,void 0)})},shallowClone:Gn,deepClone:tt,getObjectDiff:Rn,cmp:G,asap:Wn,minKey:tn,addons:[],connections:He,errnames:bn,dependencies:fn,semVer:Tn,version:Tn.split(".").map(t=>parseInt(t)).reduce((t,e,n)=>t+e/Math.pow(10,2*n))}),ge.maxKey=Ze(ge.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(me(Xe,t=>{if(!ae){let e;St?(e=document.createEvent("CustomEvent"),e.initCustomEvent(he,!0,!0,t)):e=new CustomEvent(he,{detail:t}),ae=!0,dispatchEvent(e),ae=!1}}),addEventListener(he,({detail:t})=>{ae||bt(t)}));let ae=!1;if(typeof BroadcastChannel<"u"){const t=new BroadcastChannel(he);typeof t.unref=="function"&&t.unref(),me(Xe,e=>{ae||t.postMessage(e)}),t.onmessage=e=>{e.data&&bt(e.data)}}else if(typeof self<"u"&&typeof navigator<"u"){me(Xe,e=>{try{ae||(typeof localStorage<"u"&&localStorage.setItem(he,JSON.stringify({trig:Math.random(),changedParts:e})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(n=>n.postMessage({type:he,changedParts:e})))}catch{}}),typeof addEventListener<"u"&&addEventListener("storage",e=>{if(e.key===he){const n=JSON.parse(e.newValue);n&&bt(n.changedParts)}});const t=self.document&&navigator.serviceWorker;t&&t.addEventListener("message",function({data:e}){e&&e.type===he&&bt(e.changedParts)})}C.rejectionMapper=function(t,e){if(!t||t instanceof Oe||t instanceof TypeError||t instanceof SyntaxError||!t.name||!In[t.name])return t;var n=new In[t.name](e||t.message,t);return"stack"in t&&ie(n,"stack",{get:function(){return this.inner.stack}}),n},zn(ee,lr);const w=new _e("inspection-db");w.version(5).stores({users:"++type",notes:"++id",items:"++id, category_id",categories:"++id",recommendations:"++id",jobs:"++job_number, id, status, starts_at",reportItems:"++id, report_id, name, category, previous_item, sync, [report_id+previous_item+category], created_at",previousReports:"++job_number, customer_id",deletedItems:"++id",sync:"++type"});const j=(t="Invalid Request",e=400)=>new Response(JSON.stringify({message:t}),{status:e,headers:{"Content-Type":"application/json"}}),O=t=>new Response(JSON.stringify(t),{status:200,headers:{"Content-Type":"application/json"}}),Ws=async({request:t})=>{try{const e=await t.json();return!e||(await w.users.clear(),!await w.users.add({type:"user",...e}))?j():(await w.sync.add({type:"sync",lastSync:Date.now(),lastSyncLibrary:Date.now(),clearSync:Date.now()}),O({message:"User added successfully"}))}catch(e){return j(e==null?void 0:e.message)}},Hs=async({request:t})=>{try{const e=await t.json();return e?(await w.notes.clear(),await w.notes.bulkAdd(e),O({message:"Notes added successfully"})):j()}catch(e){return j(e==null?void 0:e.message)}},Gs=async({request:t})=>{try{const e=await t.json();return e?(await w.items.clear(),await w.items.bulkAdd(e),O({message:"Items added successfully"})):j()}catch(e){return j(e==null?void 0:e.message)}},Vs=async({request:t})=>{try{const e=await t.json();return e?(await w.categories.clear(),await w.categories.bulkAdd(e),O({message:"Categories added successfully"})):j()}catch(e){return j(e==null?void 0:e.message)}},Js=async({request:t})=>{try{const e=await t.json();return e?(await w.recommendations.clear(),await w.recommendations.bulkAdd(e),O({message:"Recommendations added successfully"})):j()}catch(e){return j(e==null?void 0:e.message)}},zs=async({request:t})=>{try{const e=await t.json();return e?(await w.jobs.clear(),await w.jobs.bulkAdd(e),O({message:"Jobs added successfully"})):j()}catch(e){return j(e==null?void 0:e.message)}},Ys=async({url:t})=>{try{const e=t.searchParams.get("job_number");if(e){const s=await w.transaction("rw",w.jobs,w.reportItems,async()=>{const a=await w.jobs.get(e);if(!a)return null;if(!a.report_id)return{...a,newReportItems:0};const i=await w.reportItems.where({report_id:a.report_id,previous_item:0}).count(),o=await w.reportItems.where({report_id:a.report_id,previous_item:1}).count();return{...a,newReportItems:i,previousReportItems:o}});return s?O(s):j("No Job found")}const r=(await w.jobs.toArray()).sort((s,a)=>new Date(s.starts_at)-new Date(a.starts_at));return O(r)}catch(e){return j(e==null?void 0:e.message)}},Qs=async({url:t,request:e})=>{try{const n=t.searchParams.get("job_number"),r=await e.json();return await w.jobs.update(n,r)===0?j("Job not found"):O({message:"Job updated successfully"})}catch(n){return j(n==null?void 0:n.message)}},Xs=async()=>{try{const t=await w.notes.toArray();return O(t)}catch(t){return j(t==null?void 0:t.message)}},Zs=async({url:t,request:e})=>{var n;try{const r=t.searchParams.get("job_number"),s=await e.json(),a=await w.jobs.get(r);return a?((n=a==null?void 0:a.notes)==null?void 0:n.find(c=>c===s.note))?j("Note already exists."):await w.jobs.where("job_number").equals(r).modify(c=>{c.notes?c.notes.push(s.note):c.notes=[s.note]})===0?j():O({message:"Note added successfully"}):j()}catch{return j()}},ea=async({url:t,request:e})=>{try{const n=t.searchParams.get("job_number"),r=await e.json();return await w.jobs.where("job_number").equals(n).modify(a=>{a.notes&&a.notes.length!==0&&(a.notes=a.notes.filter(i=>i!==r.note))})===0?j():O({message:"Note deleted successfully"})}catch(n){return j(n==null?void 0:n.message)}},ta=async()=>{try{const t=await w.categories.toArray();return O(t)}catch(t){return j(t==null?void 0:t.message)}},na=async()=>{try{const e=(await w.items.toArray()).map(n=>({name:n.name,category:n.category,id:n.id}));return O(e)}catch(t){return j(t==null?void 0:t.message)}},ra=async({url:t,request:e})=>{try{const n=t.searchParams.get("job_number");n&&await w.jobs.update(n,{status:"In Progress"});const r=await e.json();return await w.reportItems.add(r)?O({message:"Item added successfully"}):j()}catch(n){return j(n==null?void 0:n.message)}},sa=async({url:t})=>{try{const e=t.searchParams.get("id");if(e){const u=await w.transaction("rw",w.reportItems,w.items,async()=>{const d=await w.reportItems.get(e);if(!d)return null;if(d.item_id){const h=await w.items.get(d.item_id);h&&(d.summary=h.summary,d.embedded_images=h.embedded_images)}return d});return u?O(u):j()}const n=t.searchParams.get("job_number");if(!n)return O();const r=t.searchParams.get("page"),s=t.searchParams.get("name"),a=t.searchParams.get("category"),i=15,o=Number(r),c=o===0?0:(o-1)*i,l=await w.transaction("rw",w.jobs,w.reportItems,async()=>{const u=await w.jobs.get(n);if(!u)return null;const d={report_id:u.report_id,previous_item:0,...a?{category:a}:{}},h=w.reportItems.where(d);if(s)return{data:(await h.toArray()).filter(k=>k.name.toLowerCase().includes(s.toLowerCase())),pages:{current_page:1,total_pages:1,next:null,prev:null}};const f=await h.count(),g=f%i===0?f/i:Math.ceil(f/i),m=await h.offset(c).limit(i).sortBy("created_at"),b=o===0?1:o;return{data:m,pages:{current_page:b,total_pages:g,next:b<g?b+1:null,prev:b>1?b-1:null}}});return l?O(l):j()}catch(e){return j(e==null?void 0:e.message)}},aa=async({url:t})=>{try{const e=t.searchParams.get("id");return e?(await w.reportItems.delete(e),await w.deletedItems.add({id:e}),O({message:"Inspection item deleted successfully"})):j()}catch(e){return O(e==null?void 0:e.message)}},ia=async()=>{try{const t=await w.recommendations.toArray();return O(t)}catch(t){return j(t==null?void 0:t.message)}},oa=async({url:t,request:e})=>{try{const n=t.searchParams.get("job_number"),r=await e.json();return await w.jobs.update(n,r)===0?j("Job not found"):O({message:"Recommendation added successfully"})}catch(n){return j(n==null?void 0:n.message)}},ca=async({url:t})=>{try{const e=t.searchParams.get("job_number");return e?await w.jobs.update(e,{recommendation:null})===0?j("Job not found"):O({message:"Recommendation removed successfully"}):j()}catch(e){return j(e==null?void 0:e.message)}},la=async({url:t})=>{try{const e=t.searchParams.get("job_number");if(!e)return j();const n=await w.transaction("rw",w.jobs,w.reportItems,w.deletedItems,async()=>{const r=await w.jobs.get(e);if(!r)return null;const s=await w.reportItems.where("sync").equals(r.report_id).toArray(),a=await w.deletedItems.toArray();return{report_items:s,deleted_report_items:a}});return n?O(n):j("Job not found")}catch(e){return j(e==null?void 0:e.message)}},ua=async({request:t})=>{try{const e=await t.json();return e.reportItems&&e.reportItems.length>0&&await w.reportItems.where("id").anyOf(e.reportItems).modify(n=>{n.sync="Synced Online"}),await w.deletedItems.clear(),O({message:"Items synced successfully"})}catch(e){return j(e==null?void 0:e.message)}},ha=async({url:t})=>{try{const e=t.searchParams.get("job_number");if(!e)return j();const n=await w.previousReports.get(e);return n?O(n):j("Report not found in offline database")}catch(e){return j(e==null?void 0:e.message)}},da=async({url:t,request:e})=>{try{const n=t.searchParams.get("job_number");if(!n)return j();const r=await e.json();return r?(await w.previousReports.put({...r,job_number:n}),O({message:"Previous report saved to offline database"})):j()}catch(n){return j(n==null?void 0:n.message)}},fa=async({url:t})=>{try{const e=t.searchParams.get("report_id");if(!e)return j();const r=(await w.reportItems.where({report_id:e,previous_item:1}).toArray()).map(s=>({id:s.id,previous_report_item_id:s.previous_report_item_id}));return O(r)}catch{return j()}},pa=async({url:t})=>{try{const e=t.searchParams.get("report_id");if(!e)return j();const n=await w.reportItems.where({report_id:e,previous_item:1}).toArray();return O(n)}catch{return j()}},ma=async({url:t})=>{try{const e=t.searchParams.get("page"),n=t.searchParams.get("category_id"),r=t.searchParams.get("name"),s=15,a=Number(e),i=a===0?0:(a-1)*s;let o;if(n?o=w.items.where("category_id").equals(n):o=w.items.toCollection(),r){const g=(await o.toArray()).filter(m=>m.name.toLowerCase().includes(r.toLowerCase()));return O({data:g,pages:{current_page:1,total_pages:1,next:null,prev:null}})}const c=await o.count(),l=c%s===0?c/s:Math.ceil(c/s),u=await o.offset(i).limit(s).toArray(),d=a===0?1:a,h={data:u,pages:{current_page:d,total_pages:l,next:d<l?d+1:null,prev:d>1?d-1:null}};return O(h)}catch(e){return j(e==null?void 0:e.message)}};class ya{constructor(e){this.baseURL=e}async request(e,n="GET",r=null,s={}){try{const a=this.baseURL+e,i=await w.users.get("user");if(!i)return{success:!1,data:null,error:"Please login again"};const o={method:n,headers:{Accept:"application/json","Content-Type":"application/json",Authorization:`Bearer ${i.access_token}`,...s}};r&&(o.body=JSON.stringify(r));const c=await fetch(a,o),l=await c.json();return c.ok?{data:l,error:null}:(c.status===401&&(location.pathname="/login"),{data:null,error:l.message||"Request failed"})}catch(a){return{data:null,error:`HTTP error: ${a.message}`}}}get(e,n={}){return this.request(e,"GET",null,n)}post(e,n,r={}){return this.request(e,"POST",n,r)}put(e,n,r={}){return this.request(e,"PUT",n,r)}delete(e,n={}){return this.request(e,"DELETE",null,n)}}const jt=new ya("/api");Yr([{"revision":null,"url":"assets/index-Ca6YgTfx.js"},{"revision":null,"url":"assets/index-Nno4m7lO.css"},{"revision":"a6959010698695e3ab916e0f2c4dfe55","url":"index.html"},{"revision":"0e1694ac4f418a9e9b9188728842ac07","url":"logo512.png"},{"revision":"3f7c481580179557064e37a5411dcd7c","url":"logo.png"},{"revision":"11db851710fdc8a8c704d9297cc80d45","url":"logo192.png"},{"revision":"55e4ad7b615a62f2c64fca53e778a06b","url":"manifest.webmanifest"}]);Vr();T(({url:t})=>t.pathname==="/client/init-user",Ws,"POST");T(({url:t})=>t.pathname==="/client/init-notes",Hs,"POST");T(({url:t})=>t.pathname==="/client/init-items",Gs,"POST");T(({url:t})=>t.pathname==="/client/init-categories",Vs,"POST");T(({url:t})=>t.pathname==="/client/init-recommendations",Js,"POST");T(({url:t})=>t.pathname==="/client/init-jobs",zs,"POST");T(({url:t})=>t.pathname==="/client/jobs",Ys,"GET");T(({url:t})=>t.pathname==="/client/jobs",Qs,"PUT");T(({url:t})=>t.pathname==="/client/notes",Xs,"GET");T(({url:t})=>t.pathname==="/client/jobs/notes",Zs,"POST");T(({url:t})=>t.pathname==="/client/jobs/notes",ea,"PUT");T(({url:t})=>t.pathname==="/client/categories",ta,"GET");T(({url:t})=>t.pathname==="/client/items-index",na,"GET");T(({url:t})=>t.pathname==="/client/jobs/report-items",ra,"POST");T(({url:t})=>t.pathname==="/client/jobs/report-items",sa,"GET");T(({url:t})=>t.pathname==="/client/jobs/report-items",aa,"DELETE");T(({url:t})=>t.pathname==="/client/recommendations",ia,"GET");T(({url:t})=>t.pathname==="/client/recommendations",oa,"POST");T(({url:t})=>t.pathname==="/client/recommendations",ca,"DELETE");T(({url:t})=>t.pathname==="/client/non-synced-items",la,"GET");T(({url:t})=>t.pathname==="/client/non-synced-items",ua,"PUT");T(({url:t})=>t.pathname==="/client/previous-report",ha,"GET");T(({url:t})=>t.pathname==="/client/previous-report",da,"POST");T(({url:t})=>t.pathname==="/client/previous-item-id",fa,"GET");T(({url:t})=>t.pathname==="/client/previous-items",pa,"GET");T(({url:t})=>t.pathname==="/client/items-library",ma,"GET");T(({url:t})=>t.pathname==="/client/sync-jobs",async()=>{if(!navigator.onLine)return j("No Internet Connection");try{const{error:t,data:e}=await jt.get("/jobs");return t?j(t):(await w.jobs.where("status").equals("Not Started").delete(),e.forEach(async n=>{await w.jobs.get(n.job_number)||await w.jobs.add(n)}),await ba(),await wa(),O({message:"App and jobs synced successfully"}))}catch(t){return j((t==null?void 0:t.name)||(t==null?void 0:t.message))}},"GET");T(({url:t})=>t.pathname==="/client/sync-items",async()=>(await ga(),O({message:"Items synced successfully"})),"GET");const ga=async()=>{try{if(!navigator.onLine)return;const t=Date.now();if(!await w.sync.get("sync"))return;const n=await w.jobs.where("status").equals("In Progress").first();if(!n)return;if(!n.sync||n.sync!=="Synced Online"){const{data:c,error:l}=await jt.post("/reports",{id:n.report_id,job_id:n.id,customer_id:n.customer.id});if(l){console.log(l);return}await w.jobs.update(n.job_number,{sync:"Synced Online"})}const r=await w.reportItems.where("sync").equals(n.report_id).toArray(),s=await w.deletedItems.toArray();if(r.length===0&&s.length===0)return;const{error:a,data:i}=await jt.post("/report-items?bulk=true",{report_items:r,deleted_report_items:s});if(a){console.log(a);return}await w.deletedItems.clear();const o=i;if(!Array.isArray(o))return;await w.reportItems.where("id").anyOf(o).modify(c=>{c.sync="Synced Online"}),await w.sync.update("sync",{lastSync:t});return}catch(t){console.log(t);return}},ba=async()=>{try{if(!navigator.onLine)return;const t=await w.sync.get("sync");if(!t)return;const e=t.lastSyncLibrary,n=Date.now();let r=new Date(e),s=r.getHours(),a=s>=12?"PM":"AM";s=s%12,s=s||12;let i=`${r.getFullYear()}-${(r.getMonth()+1).toString().padStart(2,"0")}-${r.getDate().toString().padStart(2,"0")} ${s.toString().padStart(2,"0")}:${r.getMinutes().toString().padStart(2,"0")} ${a}`;const{data:o,error:c}=await jt.get(`/sync-library?lastSync=${i}`);if(c){console.log(c);return}o.items.forEach(async l=>{l.active?await w.items.put(l):await w.items.delete(l.id)}),o.categories.forEach(async l=>{l.active?(await w.categories.put(l),await w.items.where("category_id").equals(l.id).modify(u=>{u.category=l.name,u.category_id=l.id})):await w.categories.delete(l.id)}),o.notes.forEach(async l=>{l.active?await w.notes.put(l):await w.notes.delete(l.id)}),o.recommendations.forEach(async l=>{l.active?await w.recommendations.put(l):await w.recommendations.delete(l.id)}),await w.sync.update("sync",{lastSyncLibrary:n})}catch(t){console.log(t)}},wa=async()=>{try{const t=Date.now(),e=await w.sync.get("sync");if(!e||t-e.clearSync<1e3*60*60*24)return;const n=await w.jobs.where("status").equals("Completed").toArray();if(!n||n.length===0)return;n.forEach(async r=>{await w.reportItems.where("report_id").equals(r.report_id).delete(),await w.jobs.delete(r.job_number)}),await w.previousReports.clear(),await w.sync.update("sync",{clearSync:t})}catch(t){console.log(t)}};let wr;wr=[/^\/(?!api\/)/];T(new Xr(Jr("index.html"),{allowlist:wr}));self.skipWaiting();Qr();
